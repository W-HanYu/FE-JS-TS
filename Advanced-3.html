<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>第三章:装饰器 Decorators | </title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.3a074da4.js"><link rel="modulepreload" href="/assets/Advanced-3.html.3c98b11c.js"><link rel="modulepreload" href="/assets/Advanced-3.html.3793759e.js"><link rel="prefetch" href="/assets/1.1.hello-world.html.2f51439c.js"><link rel="prefetch" href="/assets/1.10.if.html.17d4f463.js"><link rel="prefetch" href="/assets/1.11.includes.html.cd510b9b.js"><link rel="prefetch" href="/assets/1.12.parameters.html.2159eb87.js"><link rel="prefetch" href="/assets/1.13.push.html.39d4f9ee.js"><link rel="prefetch" href="/assets/1.14.unshift.html.3439eb57.js"><link rel="prefetch" href="/assets/1.2.Pick.html.b59bc144.js"><link rel="prefetch" href="/assets/1.3.Awaited.html.ff3d3003.js"><link rel="prefetch" href="/assets/1.4.Readonly.html.66bec4c3.js"><link rel="prefetch" href="/assets/1.5.Tuple-to-object.html.073fc352.js"><link rel="prefetch" href="/assets/1.6.First-of-array.html.23794c82.js"><link rel="prefetch" href="/assets/1.7.Length-of-Tuple.html.a8ffb192.js"><link rel="prefetch" href="/assets/1.8.concat.html.a113642f.js"><link rel="prefetch" href="/assets/1.9.exclude.html.b3f8155f.js"><link rel="prefetch" href="/assets/2.1.Get-Return-Type.html.5b4fc316.js"><link rel="prefetch" href="/assets/2.2.omit.html.46806c90.js"><link rel="prefetch" href="/assets/2.3.Readonly2.html.35981333.js"><link rel="prefetch" href="/assets/2.4.Deep-Readonly.html.f0a1f464.js"><link rel="prefetch" href="/assets/2.5.turn-to-union.html.dac08986.js"><link rel="prefetch" href="/assets/3.1.Simple-Vue.html.cfc6a28f.js"><link rel="prefetch" href="/assets/basic-1.html.39ebf498.js"><link rel="prefetch" href="/assets/basic-2.html.ebc9fd69.js"><link rel="prefetch" href="/assets/basic-3.html.0ca4c8e2.js"><link rel="prefetch" href="/assets/http-2.html.95069c62.js"><link rel="prefetch" href="/assets/http-3.html.cd04c82d.js"><link rel="prefetch" href="/assets/http-interview.html.c784af51.js"><link rel="prefetch" href="/assets/http-optimize.html.2f9bc246.js"><link rel="prefetch" href="/assets/http-rpc.html.8a6b850b.js"><link rel="prefetch" href="/assets/http-websocket.html.fefabd18.js"><link rel="prefetch" href="/assets/https-ecdhe.html.deb46a30.js"><link rel="prefetch" href="/assets/https-optimize.html.59cca082.js"><link rel="prefetch" href="/assets/https-rsa.html.51623a46.js"><link rel="prefetch" href="/assets/ip-base.html.d4ccd278.js"><link rel="prefetch" href="/assets/ip-ping.html.b1f4bcea.js"><link rel="prefetch" href="/assets/ip-ping_io.html.541ce16f.js"><link rel="prefetch" href="/assets/tcp-challenge-ack.html.ffeec4f3.js"><link rel="prefetch" href="/assets/tcp-dump.html.efec7cda.js"><link rel="prefetch" href="/assets/tcp-feature.html.d2c602a3.js"><link rel="prefetch" href="/assets/tcp-interview.html.93b0fdd4.js"><link rel="prefetch" href="/assets/tcp-isn-deff.html.7fc20cff.js"><link rel="prefetch" href="/assets/tcp-optimize.html.623c649a.js"><link rel="prefetch" href="/assets/tcp-out-of-order-fin.html.449ebd74.js"><link rel="prefetch" href="/assets/tcp-queue.html.4f71e2cf.js"><link rel="prefetch" href="/assets/tcp-stream.html.ee8756fb.js"><link rel="prefetch" href="/assets/tcp-syn.html.a2fbac88.js"><link rel="prefetch" href="/assets/donate.html.961368cd.js"><link rel="prefetch" href="/assets/Routine1_pattern-matching-for-extraction.html.56963a82.js"><link rel="prefetch" href="/assets/Advanced-1.html.f57f9060.js"><link rel="prefetch" href="/assets/Advanced-2.html.e9103c17.js"><link rel="prefetch" href="/assets/Advanced-4.html.898bf6b6.js"><link rel="prefetch" href="/assets/Advanced-5.html.00d52f38.js"><link rel="prefetch" href="/assets/Extended-article-1.html.fab6e63d.js"><link rel="prefetch" href="/assets/base-1.html.7b2573da.js"><link rel="prefetch" href="/assets/base-10.html.e41deff3.js"><link rel="prefetch" href="/assets/base-11.html.c4cb2d9f.js"><link rel="prefetch" href="/assets/base-12.html.13bff5ee.js"><link rel="prefetch" href="/assets/base-13.html.7e441658.js"><link rel="prefetch" href="/assets/base-14.html.3e4d8532.js"><link rel="prefetch" href="/assets/base-15.html.f1e1d13f.js"><link rel="prefetch" href="/assets/base-16.html.63add677.js"><link rel="prefetch" href="/assets/base-17.html.9d73d4c7.js"><link rel="prefetch" href="/assets/base-2.html.893b18a3.js"><link rel="prefetch" href="/assets/base-3.html.e6617e04.js"><link rel="prefetch" href="/assets/base-4.html.513dbea8.js"><link rel="prefetch" href="/assets/base-5.html.40d14ecb.js"><link rel="prefetch" href="/assets/base-6.html.5b0fa07f.js"><link rel="prefetch" href="/assets/base-7.html.5b19c6f9.js"><link rel="prefetch" href="/assets/base-8.html.e0c26be4.js"><link rel="prefetch" href="/assets/base-9.html.8398e418.js"><link rel="prefetch" href="/assets/rollup-1.html.320df097.js"><link rel="prefetch" href="/assets/rollup-10.html.6e420b35.js"><link rel="prefetch" href="/assets/rollup-11.html.ded183c5.js"><link rel="prefetch" href="/assets/rollup-2.html.53982b31.js"><link rel="prefetch" href="/assets/rollup-3.html.fa852f4a.js"><link rel="prefetch" href="/assets/rollup-4.html.6e964868.js"><link rel="prefetch" href="/assets/rollup-5.html.d93d5225.js"><link rel="prefetch" href="/assets/rollup-6.html.77224b5c.js"><link rel="prefetch" href="/assets/rollup-7.html.253f8a66.js"><link rel="prefetch" href="/assets/rollup-8.html.303cd98d.js"><link rel="prefetch" href="/assets/rollup-9.html.1f7d5428.js"><link rel="prefetch" href="/assets/scope-closures-appA.html.4247cff9.js"><link rel="prefetch" href="/assets/scope-closures-appB.html.cc173c88.js"><link rel="prefetch" href="/assets/scope-closures-appC.html.eee76227.js"><link rel="prefetch" href="/assets/this-object-prototype-appA.html.b5826a90.js"><link rel="prefetch" href="/assets/async-performance-apA.html.73fe9b81.js"><link rel="prefetch" href="/assets/async-performance-apB.html.a3282496.js"><link rel="prefetch" href="/assets/async-performance-ch1.html.d5ff5d19.js"><link rel="prefetch" href="/assets/async-performance-ch2.html.5c702910.js"><link rel="prefetch" href="/assets/async-performance-ch3.html.741f3f32.js"><link rel="prefetch" href="/assets/async-performance-ch4.html.773838c8.js"><link rel="prefetch" href="/assets/async-performance-ch5.html.5b25dd7e.js"><link rel="prefetch" href="/assets/async-performance-ch6.html.e396043d.js"><link rel="prefetch" href="/assets/types-grammar-1.html.30426f08.js"><link rel="prefetch" href="/assets/types-grammar-2.html.dc601ece.js"><link rel="prefetch" href="/assets/types-grammar-3.html.d56cf893.js"><link rel="prefetch" href="/assets/types-grammar-4.html.c6425b24.js"><link rel="prefetch" href="/assets/types-grammar-5.html.721bd170.js"><link rel="prefetch" href="/assets/types-grammar-apA.html.765425aa.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/1.1.hello-world.html.dbb990f2.js"><link rel="prefetch" href="/assets/1.10.if.html.ae82d89d.js"><link rel="prefetch" href="/assets/1.11.includes.html.fa3c56b2.js"><link rel="prefetch" href="/assets/1.12.parameters.html.1943cca3.js"><link rel="prefetch" href="/assets/1.13.push.html.f8ed0d03.js"><link rel="prefetch" href="/assets/1.14.unshift.html.22b62912.js"><link rel="prefetch" href="/assets/1.2.Pick.html.76240b85.js"><link rel="prefetch" href="/assets/1.3.Awaited.html.d5e5c07d.js"><link rel="prefetch" href="/assets/1.4.Readonly.html.3213ed76.js"><link rel="prefetch" href="/assets/1.5.Tuple-to-object.html.a497f83c.js"><link rel="prefetch" href="/assets/1.6.First-of-array.html.2d219f76.js"><link rel="prefetch" href="/assets/1.7.Length-of-Tuple.html.90af7747.js"><link rel="prefetch" href="/assets/1.8.concat.html.d4c5dc29.js"><link rel="prefetch" href="/assets/1.9.exclude.html.fde650b6.js"><link rel="prefetch" href="/assets/2.1.Get-Return-Type.html.2a0fbf33.js"><link rel="prefetch" href="/assets/2.2.omit.html.c1029f82.js"><link rel="prefetch" href="/assets/2.3.Readonly2.html.73ea1c5c.js"><link rel="prefetch" href="/assets/2.4.Deep-Readonly.html.1e19e1d7.js"><link rel="prefetch" href="/assets/2.5.turn-to-union.html.6d02e300.js"><link rel="prefetch" href="/assets/3.1.Simple-Vue.html.cf7d2114.js"><link rel="prefetch" href="/assets/basic-1.html.2d1468f2.js"><link rel="prefetch" href="/assets/basic-2.html.03e8f1b3.js"><link rel="prefetch" href="/assets/basic-3.html.c37bc75e.js"><link rel="prefetch" href="/assets/http-2.html.32675791.js"><link rel="prefetch" href="/assets/http-3.html.b67adbbe.js"><link rel="prefetch" href="/assets/http-interview.html.eaae0aae.js"><link rel="prefetch" href="/assets/http-optimize.html.eaf809c2.js"><link rel="prefetch" href="/assets/http-rpc.html.d87186f3.js"><link rel="prefetch" href="/assets/http-websocket.html.f0ade5b8.js"><link rel="prefetch" href="/assets/https-ecdhe.html.c14d0a68.js"><link rel="prefetch" href="/assets/https-optimize.html.7ea0e6ab.js"><link rel="prefetch" href="/assets/https-rsa.html.fa73904d.js"><link rel="prefetch" href="/assets/ip-base.html.7de5ae2f.js"><link rel="prefetch" href="/assets/ip-ping.html.dd631318.js"><link rel="prefetch" href="/assets/ip-ping_io.html.87cc138a.js"><link rel="prefetch" href="/assets/tcp-challenge-ack.html.14df771a.js"><link rel="prefetch" href="/assets/tcp-dump.html.e0116aab.js"><link rel="prefetch" href="/assets/tcp-feature.html.014a5c06.js"><link rel="prefetch" href="/assets/tcp-interview.html.a3e5e864.js"><link rel="prefetch" href="/assets/tcp-isn-deff.html.4a06d474.js"><link rel="prefetch" href="/assets/tcp-optimize.html.c2ecb4b3.js"><link rel="prefetch" href="/assets/tcp-out-of-order-fin.html.85ec8406.js"><link rel="prefetch" href="/assets/tcp-queue.html.e2659d5c.js"><link rel="prefetch" href="/assets/tcp-stream.html.488aa6a5.js"><link rel="prefetch" href="/assets/tcp-syn.html.d9de5837.js"><link rel="prefetch" href="/assets/donate.html.f2bccb7b.js"><link rel="prefetch" href="/assets/Routine1_pattern-matching-for-extraction.html.c689d376.js"><link rel="prefetch" href="/assets/Advanced-1.html.d5ab5803.js"><link rel="prefetch" href="/assets/Advanced-2.html.6c4f8a18.js"><link rel="prefetch" href="/assets/Advanced-4.html.cc999ef3.js"><link rel="prefetch" href="/assets/Advanced-5.html.87eea8ef.js"><link rel="prefetch" href="/assets/Extended-article-1.html.1afe326e.js"><link rel="prefetch" href="/assets/base-1.html.143ededb.js"><link rel="prefetch" href="/assets/base-10.html.ddc9fcf0.js"><link rel="prefetch" href="/assets/base-11.html.68c2cd09.js"><link rel="prefetch" href="/assets/base-12.html.2a3fb063.js"><link rel="prefetch" href="/assets/base-13.html.b3cfd0b4.js"><link rel="prefetch" href="/assets/base-14.html.b3907d4d.js"><link rel="prefetch" href="/assets/base-15.html.754606f1.js"><link rel="prefetch" href="/assets/base-16.html.c06a55f8.js"><link rel="prefetch" href="/assets/base-17.html.f732ccd5.js"><link rel="prefetch" href="/assets/base-2.html.4d000639.js"><link rel="prefetch" href="/assets/base-3.html.5bc479b8.js"><link rel="prefetch" href="/assets/base-4.html.1c042615.js"><link rel="prefetch" href="/assets/base-5.html.c21b64d7.js"><link rel="prefetch" href="/assets/base-6.html.197e9beb.js"><link rel="prefetch" href="/assets/base-7.html.2487bb3e.js"><link rel="prefetch" href="/assets/base-8.html.b525a8c6.js"><link rel="prefetch" href="/assets/base-9.html.f20763fd.js"><link rel="prefetch" href="/assets/rollup-1.html.26e3f8ec.js"><link rel="prefetch" href="/assets/rollup-10.html.74c99754.js"><link rel="prefetch" href="/assets/rollup-11.html.7a900bc3.js"><link rel="prefetch" href="/assets/rollup-2.html.8d9b4f20.js"><link rel="prefetch" href="/assets/rollup-3.html.d2ea99d8.js"><link rel="prefetch" href="/assets/rollup-4.html.c3b9d0f7.js"><link rel="prefetch" href="/assets/rollup-5.html.c4ce792b.js"><link rel="prefetch" href="/assets/rollup-6.html.3fa77458.js"><link rel="prefetch" href="/assets/rollup-7.html.92b371ea.js"><link rel="prefetch" href="/assets/rollup-8.html.f9929e81.js"><link rel="prefetch" href="/assets/rollup-9.html.e114323d.js"><link rel="prefetch" href="/assets/scope-closures-appA.html.36941822.js"><link rel="prefetch" href="/assets/scope-closures-appB.html.88591296.js"><link rel="prefetch" href="/assets/scope-closures-appC.html.1330c55e.js"><link rel="prefetch" href="/assets/this-object-prototype-appA.html.79d1d032.js"><link rel="prefetch" href="/assets/async-performance-apA.html.f8027894.js"><link rel="prefetch" href="/assets/async-performance-apB.html.f0742808.js"><link rel="prefetch" href="/assets/async-performance-ch1.html.fe31721c.js"><link rel="prefetch" href="/assets/async-performance-ch2.html.8cc20d2a.js"><link rel="prefetch" href="/assets/async-performance-ch3.html.30e7d7d6.js"><link rel="prefetch" href="/assets/async-performance-ch4.html.d1fae809.js"><link rel="prefetch" href="/assets/async-performance-ch5.html.1bb99263.js"><link rel="prefetch" href="/assets/async-performance-ch6.html.532f5a8f.js"><link rel="prefetch" href="/assets/types-grammar-1.html.2a677751.js"><link rel="prefetch" href="/assets/types-grammar-2.html.ff0413a9.js"><link rel="prefetch" href="/assets/types-grammar-3.html.ab543605.js"><link rel="prefetch" href="/assets/types-grammar-4.html.7f61c946.js"><link rel="prefetch" href="/assets/types-grammar-5.html.ca0b5d4b.js"><link rel="prefetch" href="/assets/types-grammar-apA.html.d1511322.js"><link rel="prefetch" href="/assets/404.html.92978749.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">第三章:装饰器 Decorators <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-装饰器-decorators" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.装饰器 Decorators"><!--[--><!--]--> 3.装饰器 Decorators <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-1-装饰者模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 装饰者模式"><!--[--><!--]--> 3.1 装饰者模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-2-typescript-装饰器" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 Typescript 装饰器"><!--[--><!--]--> 3.2 Typescript 装饰器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-3-装饰器的使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 装饰器的使用"><!--[--><!--]--> 3.3 装饰器的使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-4-装饰器工厂" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 装饰器工厂"><!--[--><!--]--> 3.4 装饰器工厂 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-5-类装饰器" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5 类装饰器"><!--[--><!--]--> 3.5 类装饰器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-6-方法装饰器" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6 方法装饰器"><!--[--><!--]--> 3.6 方法装饰器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-7-属性装饰器" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.7 属性装饰器"><!--[--><!--]--> 3.7 属性装饰器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-8-其他装饰器的写法" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.8 其他装饰器的写法"><!--[--><!--]--> 3.8 其他装饰器的写法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/you-dont-know-ts/Advanced-3.html#_3-9-装饰器运行时代码分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.9 装饰器运行时代码分析"><!--[--><!--]--> 3.9 装饰器运行时代码分析 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="_3-装饰器-decorators" tabindex="-1"><a class="header-anchor" href="#_3-装饰器-decorators" aria-hidden="true">#</a> 3.装饰器 Decorators</h2><h3 id="_3-1-装饰者模式" tabindex="-1"><a class="header-anchor" href="#_3-1-装饰者模式" aria-hidden="true">#</a> 3.1 装饰者模式</h3><p>装饰者模式（Decorator Pattern）也称为装饰器模式，在不改变对象自身的基础上，动态增加额外的职责。属于结构型模式的一种。</p><p>使用装饰者模式的优点：把对象核心职责和要装饰的功能分开了。非侵入式的行为修改。</p><p>举个例子来说，原本长相一般的女孩，借助美颜功能，也能拍出逆天的颜值。只要善于运用辅助的装饰功能，开启瘦脸，增大眼睛，来点磨皮后，咔嚓一拍，惊艳无比。</p><p>经过这一系列叠加的装饰，你还是你，长相不增不减，却能在镜头前增加了多重美。如果你愿意，还可以尝试不同的装饰风格，只要装饰功能做的好，你就能成为“百变星君”。</p><p>可以用代码表示，把每个功能抽象成一个类：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 女孩子</span>
<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span>
  <span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我原本的脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ThinFace</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>girl <span class="token operator">=</span> girl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>girl<span class="token punctuation">.</span><span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开启瘦脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">IncreasingEyes</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>girl <span class="token operator">=</span> girl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>girl<span class="token punctuation">.</span><span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;增大眼睛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从代码的表现来看，将一个对象嵌入到另一个对象中，相当于通过一个对象对另一个对象进行包装，形成一条包装链。调用后，随着包装的链条传递给每一个对象，让每个对象都有处理的机会。</p><p>这种方式在增加删除装饰功能上都有极大的灵活性，假如你有勇气展示真实的脸，去掉瘦脸的包装即可，这对其他功能毫无影响；假如要增加磨皮，再来个功能类，继续装饰下去，对其他功能也无影响，可以并存运行。</p><p>在 javascript 中增加小功能使用类，显的有点笨重，JavaScript 的优点是灵活，可以使用对象来表示：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">let</span> girl <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我原本的脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开启瘦脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">IncreasingEyes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;增大眼睛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

girl<span class="token punctuation">.</span>faceValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> originalFaveValue <span class="token operator">=</span> girl<span class="token punctuation">.</span>faceValue<span class="token punctuation">;</span> <span class="token comment">// 原来的功能</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">originalFaveValue</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">thinFace</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
girl<span class="token punctuation">.</span>faceValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> originalFaveValue <span class="token operator">=</span> girl<span class="token punctuation">.</span>faceValue<span class="token punctuation">;</span> <span class="token comment">// 原来的功能</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">originalFaveValue</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IncreasingEyes</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在不改变原来代码的基础上，通过先保留原来函数，重新改写，在重写的代码中调用原来保留的函数。</p><p>用一张图来表示装饰者模式的原理：</p><p><img src="/assets/decorators.abbba51d.png" alt="3"></p><p>从图中可以看出来，通过一层层的包装，增加了原先对象的功能。</p><h3 id="_3-2-typescript-装饰器" tabindex="-1"><a class="header-anchor" href="#_3-2-typescript-装饰器" aria-hidden="true">#</a> 3.2 Typescript 装饰器</h3><p>Javascript 规范里的装饰器目前处在 建议征集的第二阶段，也就意味着不能在原生代码中直接使用，浏览器暂不支持。</p><p>可以通过 babel 或 TypeScript 工具在编译阶段，把装饰器语法转换成浏览器可执行的代码。（最后会有编译后的源码分析）</p><p>以下主要讨论 TypeScript 中装饰器的使用。</p><p>TypeScript 中的装饰器可以被附加到类声明、方法、 访问符(getter/setter)、属性和参数上。</p><p>开启对装饰器的支持，命令行 编译文件时</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>tsc <span class="token operator">--</span>target <span class="token constant">ES5</span> <span class="token operator">--</span>experimentalDecorators test<span class="token punctuation">.</span>ts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>配置文件 tsconfig.json</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ES5&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;experimentalDecorators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-装饰器的使用" tabindex="-1"><a class="header-anchor" href="#_3-3-装饰器的使用" aria-hidden="true">#</a> 3.3 装饰器的使用</h3><p>装饰器实际上就是一个函数，在使用时前面加上 @ 符号，写在要装饰的声明之前，多个装饰器同时作用在一个声明时，可以写一行或换行写：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 换行写</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">test1</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">test2</span></span>
declaration

<span class="token comment">//写一行</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">test1</span></span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">test2</span></span> <span class="token operator">...</span>
declaration
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>定义 face.ts 文件：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开启瘦脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">thinFace</span></span>
<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译成 js 代码，在运行时，会直接调用 thinFace 函数。这个装饰器作用在类上，称之为类装饰器。</p><p>如果需要附加多个功能，可以组合多个装饰器一起使用：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开启瘦脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">IncreasingEyes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;增大眼睛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">thinFace</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">IncreasingEyes</span></span>
<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>多个装饰器组合在一起，在运行时，要注意，调用顺序是 从下至上 依次调用，正好和书写的顺序相反。例子中给出的运行结果是：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token string">&quot;增大眼睛&quot;</span><span class="token punctuation">;</span>
<span class="token string">&quot;开启瘦脸&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你要在一个装饰器中给类添加属性，在其他的装饰器中使用，那就要写在最后一个装饰器中，因为最后写的装饰器最先调用。</p><h3 id="_3-4-装饰器工厂" tabindex="-1"><a class="header-anchor" href="#_3-4-装饰器工厂" aria-hidden="true">#</a> 3.4 装饰器工厂</h3><p>有时需要给装饰器传递一些参数，这要借助于装饰器工厂函数。装饰器工厂函数实际上就是一个高阶函数，在调用后返回一个函数，返回的函数作为装饰器函数。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1-瘦脸工厂方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">4-我是瘦脸的装饰器，要瘦脸</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">IncreasingEyes</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2-增大眼睛工厂方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">3-我是增大眼睛的装饰器，要</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">thinFace</span></span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">IncreasingEyes</span></span><span class="token punctuation">(</span><span class="token string">&quot;增大一倍&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@ 符号后为调用工厂函数，依次从上到下执行，目的是求得装饰器函数。装饰器函数的运行顺序依然是从下到上依次执行。</p><p>运行的结果为：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token number">1</span><span class="token operator">-</span>瘦脸工厂方法
<span class="token number">2</span><span class="token operator">-</span>增大眼睛工厂方法
<span class="token number">3</span><span class="token operator">-</span>我是增大眼睛的装饰器，要增大一倍
<span class="token number">4</span><span class="token operator">-</span>我是瘦脸的装饰器，要瘦脸<span class="token number">50</span><span class="token operator">%</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>总结一下：</p><ul><li>写了工厂函数，从上到下依次执行，求得装饰器函数。</li><li>装饰器函数的执行顺序是 从下到上 依次执行。</li></ul></li></ul><h3 id="_3-5-类装饰器" tabindex="-1"><a class="header-anchor" href="#_3-5-类装饰器" aria-hidden="true">#</a> 3.5 类装饰器</h3><p>作用在类声明上的装饰器，可以给我们改变类的机会。在执行装饰器函数时，会把类构造函数传递给装饰器函数。</p><p>类装饰器在类声明之前被声明（紧靠着类声明）。 类装饰器应用于类构造函数，可以用来监视，修改或替换类定义。 类装饰器不能用在声明文件中( .d.ts)，也不能用在任何外部上下文中（比如 declare 的类）。</p><p>类装饰器表达式会在运行时当作函数被调用，类的构造函数作为其唯一的参数。</p><p>如果类装饰器返回一个值，它会使用提供的构造函数来替换类的声明。</p><p>注意 如果你要返回一个新的构造函数，你必须注意处理好原来的原型链。 在运行时的装饰器调用逻辑中 不会为你做这些。</p><p>下面是使用类装饰器(@sealed)的例子，应用在 Greeter 类：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">sealed</span></span>
<span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>
  greeting<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以这样定义@sealed 装饰器：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">sealed</span><span class="token punctuation">(</span>constructor<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span>constructor<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当@sealed 被执行的时候，它将密封此类的构造函数和原型。(注：参见 Object.seal)</p><p>下面是一个重载构造函数的例子。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">classDecorator</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  constructor<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token keyword">extends</span></span> constructor <span class="token punctuation">{</span>
    newProperty <span class="token operator">=</span> <span class="token string">&quot;new property&quot;</span><span class="token punctuation">;</span>
    hello <span class="token operator">=</span> <span class="token string">&quot;override&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">classDecorator</span></span>
<span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>
  property <span class="token operator">=</span> <span class="token string">&quot;property&quot;</span><span class="token punctuation">;</span>
  hello<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>m<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hello <span class="token operator">=</span> m<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">classDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>constructor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;接收一个构造函数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  constructor<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">thinFaceFeature</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;瘦脸功能&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">thinFace</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">classDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;类装饰器&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Girl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

g<span class="token punctuation">.</span><span class="token function">thinFaceFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#39;瘦脸功能&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子中，拿到传递构造函数后，就可以给构造函数原型上增加新的方法，甚至也可以继承别的类。</p><h3 id="_3-6-方法装饰器" tabindex="-1"><a class="header-anchor" href="#_3-6-方法装饰器" aria-hidden="true">#</a> 3.6 方法装饰器</h3><p>方法装饰器声明在一个方法的声明之前（紧靠着方法声明）。 它会被应用到方法的 属性描述符上，可以用来监视，修改或者替换方法定义。 方法装饰器不能用在声明文件( .d.ts)，重载或者任何外部上下文（比如 declare 的类）中。</p><p>方法装饰器表达式会在运行时当作函数被调用，传入下列 3 个参数：</p><p>对于静态成员来说是类的构造函数，对于实例成员是类的原型对象。 成员的名字。 成员的属性描述符。 注意   如果代码输出目标版本小于 ES5，属性描述符将会是 undefined。</p><p>如果方法装饰器返回一个值，它会被用作方法的属性描述符。</p><p>注意   如果代码输出目标版本小于 ES5 返回值会被忽略。</p><p>下面是一个方法装饰器（@enumerable）的例子，应用于 Greeter 类的方法上：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>
  greeting<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">enumerable</span></span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以用下面的函数声明来定义@enumerable 装饰器：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">enumerable</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
    target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
    propertyKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    descriptor<span class="token operator">:</span> PropertyDescriptor
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    descriptor<span class="token punctuation">.</span>enumerable <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的@enumerable(false)是一个装饰器工厂。 当装饰器 @enumerable(false)被调用时，它会修改属性描述符的 enumerable 属性。</p><p>作用在类的方法上，有静态方法和原型方法。作用在静态方法上，装饰器函数接收的是类构造函数；作用在原型方法上，装饰器函数接收的是原型对象。 这里拿作用在原型方法上举例。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">methodDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> Girl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">&quot;接收原型对象，装饰的属性名，属性描述符&quot;</span><span class="token punctuation">,</span>
      Girl<span class="token punctuation">.</span>prototype <span class="token operator">===</span> prototype
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 保留原来的方法逻辑</span>
  <span class="token keyword">let</span> originalMethod <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token comment">// 改写，增加逻辑，并执行原有逻辑</span>
  descriptor<span class="token punctuation">.</span><span class="token function-variable function">value</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">originalMethod</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意修改 this 的指向</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开启瘦脸模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">thinFace</span></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">methodDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;方式装饰器&quot;</span><span class="token punctuation">,</span> Girl<span class="token punctuation">)</span>
  <span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是原本的面目&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Girl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

g<span class="token punctuation">.</span><span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从代码中可以看出，装饰器函数接收三个参数，原型对象、方法名、描述对象。对描述对象陌生的，可以参考 这里;</p><p>要增强功能，可以先保留原来的函数，改写描述对象的 value 为另一函数。</p><p>当使用 g.faceValue() 访问方法时，访问的就是描述对象 value 对应的值。</p><p>在改写的函数中增加逻辑，并执行原来保留的原函数。注意原函数要用 call 或 apply 将 this 指向原型对象。</p><h3 id="_3-7-属性装饰器" tabindex="-1"><a class="header-anchor" href="#_3-7-属性装饰器" aria-hidden="true">#</a> 3.7 属性装饰器</h3><p>作用在类中定义的属性上，这些属性不是原型上的属性，而是通过类实例化得到的实例对象上的属性。</p><p>装饰器同样会接受两个参数，原型对象，和属性名。而没有属性描述对象，为什么呢？这与 TypeScript 是如何初始化属性装饰器的有关。 目前没有办法在定义一个原型对象的成员时描述一个实例属性。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">propertyDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> Girl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">&quot;接收原型对象，装饰的属性名，属性描述符&quot;</span><span class="token punctuation">,</span>
      Girl<span class="token punctuation">.</span>prototype <span class="token operator">===</span> prototype
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">thinFace</span></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">propertyDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;属性装饰器&quot;</span><span class="token punctuation">,</span> Girl<span class="token punctuation">)</span>
  <span class="token keyword">public</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Girl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-8-其他装饰器的写法" tabindex="-1"><a class="header-anchor" href="#_3-8-其他装饰器的写法" aria-hidden="true">#</a> 3.8 其他装饰器的写法</h3><p>下面组合多个装饰器写在一起，出了上面提到的三种，还有 访问符装饰器、参数装饰器。这些装饰器在一起时，会有执行顺序。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">classDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">propertyDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;propertyDecorator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">methodDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;methodDecorator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">paramDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;paramDecorator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">AccessDecorator</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;AccessDecorator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">thinFace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;瘦脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">IncreasingEyes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;增大眼睛&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">thinFace</span></span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">classDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;类装饰器&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Girl</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">propertyDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;属性装饰器&quot;</span><span class="token punctuation">)</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">AccessDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;访问符装饰器&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">get</span> <span class="token function">city</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">methodDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;方法装饰器&quot;</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IncreasingEyes</span></span>
  <span class="token function">faceValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;原本的脸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">paramDecorator</span></span><span class="token punctuation">(</span><span class="token string">&quot;参数装饰器&quot;</span><span class="token punctuation">)</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行了这段编译后的代码，会发现这些访问器的顺序是，属性装饰器 -&gt; 访问符装饰器 -&gt; 方法装饰器 -&gt; 参数装饰器 -&gt; 类装饰器。</p><p><a href="https://www.tslang.cn/docs/handbook/decorators.html#decorator-factories" target="_blank" rel="noopener noreferrer">更详细的用法可以参考官网文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_3-9-装饰器运行时代码分析" tabindex="-1"><a class="header-anchor" href="#_3-9-装饰器运行时代码分析" aria-hidden="true">#</a> 3.9 装饰器运行时代码分析</h3><p>装饰器在浏览器中不支持，没办法直接使用，需要经过工具编译成浏览器可执行的代码。</p><p>分析一下通过工具编译后的代码。</p><p>生成 face.js 文件：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>

tsc <span class="token operator">--</span>target <span class="token constant">ES5</span> <span class="token operator">--</span>experimentalDecorators face<span class="token punctuation">.</span>ts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>打开 face.js 文件，会看到一段被压缩后的代码，可以格式化一下。</p><p>先看这段代码：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token operator">**</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token function">propertyDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;属性装饰器&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> Girl<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">**</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token function">AccessDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;访问符装饰器&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> Girl<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&quot;city&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">**</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token function">methodDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;方法装饰器&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
IncreasingEyes
<span class="token punctuation">]</span><span class="token punctuation">,</span> Girl<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&quot;faceValue&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">**</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token function">__param</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">paramDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;参数装饰器&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> Girl<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&quot;getAge&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Girl <span class="token operator">=</span> <span class="token operator">**</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
thinFace<span class="token punctuation">,</span>
<span class="token function">classDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;类装饰器&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> Girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**decorate 的作用就是执行装饰器函数，从这段代码中能够看出很多信息，印证上面得到的结论。</p><p>通过__decorate 调用顺序，可以看出来，多个类型的装饰器一起使用时，顺序是，属性装饰器 -&gt; 访问符装饰器 -&gt; 方法装饰器 -&gt; 参数装饰器 -&gt; 类装饰器。</p><p>调用了 __decorate 函数，根据使用的装饰器类型不同，传入的参数也不相同。</p><p>第一个参数传入的都一样，为数组，这样确保和我们书写的顺序一致，每一项是求值后的装饰器函数，如果写的是 @propertyDecorator() 则一上来就执行，得到装饰器函数，这跟上面分析的一致。</p><p>类装饰器会把类作为第二个参数，其他的装饰器，把原型对象作为第二个参数，属性名作为第三个，第四个是 null 或 void 0。void 0 的值为 undefined，也就等于没传参数</p><p>要记住传给 **decorate 函数参数的个数和值，在深入到 **decorate 源码中， 会根据这些值来决定执行装饰器函数时，传入参数的多少。</p><p>好，来看 __decorate 函数实现：</p><p>// 已存在此函数，直接使用，否则自己定义</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">var</span> <span class="token operator">**</span>decorate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token operator">**</span>decorate<span class="token punctuation">)</span> <span class="token operator">||</span>
<span class="token comment">// 接收四个参数：</span>
<span class="token comment">//decorators 存放装饰器函数的数组、target 原型对象|类，</span>
<span class="token comment">//key 属性名、desc 描述（undefined 或 null）</span>
<span class="token keyword">function</span><span class="token punctuation">(</span>decorators<span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
<span class="token comment">// 拿到参数的个数</span>
r <span class="token operator">=</span> c <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token comment">// 参数小于三个，说明是类装饰器，直接拿到类</span>
<span class="token operator">?</span> target
<span class="token operator">:</span> desc <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token comment">// 第四个参数为 null，则需要描述对象；属性装饰器传入是 void 0，没有描述对象。</span>
<span class="token operator">?</span> desc <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token operator">:</span> desc<span class="token punctuation">,</span>
d<span class="token punctuation">;</span>
<span class="token comment">// 如果提供了 Reflect.decorate 方法，直接调用；否则自己实现</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Reflect <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Reflect<span class="token punctuation">.</span>decorate <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span>decorators<span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
<span class="token comment">// 装饰器函数执行顺序和书写的顺序相反，从下至上 执行</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> decorators<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">=</span> decorators<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 拿到装饰器函数</span>
r <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token comment">// 参数小于 3 个，说明是类装饰器，执行装饰器函数，直接传入类</span>
<span class="token operator">?</span> <span class="token function">d</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token operator">:</span> c <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token comment">// 参数大于三个，是方法装饰器、访问符装饰器、参数装饰器，则执行传入描述对象</span>
<span class="token operator">?</span> <span class="token function">d</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token operator">:</span> <span class="token function">d</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token comment">// 为属性装饰器，不传入描述对象</span>
<span class="token punctuation">)</span> <span class="token operator">||</span> r<span class="token punctuation">;</span>

<span class="token comment">// 给被装饰的属性，设置得到的描述对象，主要是针对，方法、属性来说的</span>
<span class="token operator">/</span>_\<span class="token operator">*</span>\<span class="token operator">*</span>
_ r 的值分两种情况，
_ 一种是通过上面的 Object<span class="token punctuation">.</span>getOwnPropertyDescriptor 得到的值
_ 另一种，是装饰器函数执行后的返回值，作为描述对象。
_ 一般不给装饰器函数返回值。
_<span class="token operator">/</span>
<span class="token keyword">return</span> c <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> r <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span>r<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的参数装饰器，调用了一个函数为 __params，</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">var</span> <span class="token operator">**</span>param <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token operator">**</span>param<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>paramIndex<span class="token punctuation">,</span> decorator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">decorator</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> paramIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>`
目的是，要给装饰器函数传入参数的位置 paramIndex。

看了编译后的源码，相信会对装饰器的理解更深刻。

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1453300745@qq.com">wangtao</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.3a074da4.js" defer></script>
  </body>
</html>
