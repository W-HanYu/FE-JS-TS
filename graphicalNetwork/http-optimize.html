<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>HTTP/1.1 如何优化？ | </title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.2732c273.js"><link rel="modulepreload" href="/assets/http-optimize.html.54a0c422.js"><link rel="modulepreload" href="/assets/http-optimize.html.bf9f6968.js"><link rel="prefetch" href="/assets/1.1.hello-world.html.12bb0e13.js"><link rel="prefetch" href="/assets/1.10.if.html.f72acab8.js"><link rel="prefetch" href="/assets/1.11.includes.html.c44d24e2.js"><link rel="prefetch" href="/assets/1.12.parameters.html.bee3996d.js"><link rel="prefetch" href="/assets/1.13.push.html.1b4a1670.js"><link rel="prefetch" href="/assets/1.14.unshift.html.63c7d941.js"><link rel="prefetch" href="/assets/1.2.Pick.html.16d7c332.js"><link rel="prefetch" href="/assets/1.3.Awaited.html.b7b8861b.js"><link rel="prefetch" href="/assets/1.4.Readonly.html.b0e6536d.js"><link rel="prefetch" href="/assets/1.5.Tuple-to-object.html.fdea6785.js"><link rel="prefetch" href="/assets/1.6.First-of-array.html.85cfae14.js"><link rel="prefetch" href="/assets/1.7.Length-of-Tuple.html.6c7e67cd.js"><link rel="prefetch" href="/assets/1.8.concat.html.7ba570b8.js"><link rel="prefetch" href="/assets/1.9.exclude.html.101ba010.js"><link rel="prefetch" href="/assets/2.1.Get-Return-Type.html.23e52fd1.js"><link rel="prefetch" href="/assets/2.2.omit.html.64e70725.js"><link rel="prefetch" href="/assets/2.3.Readonly2.html.3ba1e1ed.js"><link rel="prefetch" href="/assets/2.4.Deep-Readonly.html.d64b17c0.js"><link rel="prefetch" href="/assets/2.5.turn-to-union.html.fdcd0d90.js"><link rel="prefetch" href="/assets/3.1.Simple-Vue.html.841c3f0c.js"><link rel="prefetch" href="/assets/basic-1.html.c99e29f8.js"><link rel="prefetch" href="/assets/basic-2.html.befd557a.js"><link rel="prefetch" href="/assets/basic-3.html.7785812c.js"><link rel="prefetch" href="/assets/http-2.html.12989505.js"><link rel="prefetch" href="/assets/http-3.html.08c090fa.js"><link rel="prefetch" href="/assets/http-interview.html.f13f1d3f.js"><link rel="prefetch" href="/assets/http-rpc.html.bb365a52.js"><link rel="prefetch" href="/assets/http-websocket.html.ae2081a0.js"><link rel="prefetch" href="/assets/https-ecdhe.html.9f35e6f0.js"><link rel="prefetch" href="/assets/https-optimize.html.390116d3.js"><link rel="prefetch" href="/assets/https-rsa.html.2235cc59.js"><link rel="prefetch" href="/assets/ip-base.html.90345cd2.js"><link rel="prefetch" href="/assets/ip-ping.html.0f9b754e.js"><link rel="prefetch" href="/assets/ip-ping_io.html.efd92845.js"><link rel="prefetch" href="/assets/tcp-challenge-ack.html.45ee9061.js"><link rel="prefetch" href="/assets/tcp-dump.html.1b348a83.js"><link rel="prefetch" href="/assets/tcp-feature.html.b3c16c5e.js"><link rel="prefetch" href="/assets/tcp-interview.html.48df2854.js"><link rel="prefetch" href="/assets/tcp-isn-deff.html.a1946069.js"><link rel="prefetch" href="/assets/tcp-optimize.html.de55ffb0.js"><link rel="prefetch" href="/assets/tcp-out-of-order-fin.html.6aabbf58.js"><link rel="prefetch" href="/assets/tcp-queue.html.1c9e6a35.js"><link rel="prefetch" href="/assets/tcp-stream.html.ee2d3d84.js"><link rel="prefetch" href="/assets/tcp-syn.html.3e59422b.js"><link rel="prefetch" href="/assets/donate.html.2cae8f34.js"><link rel="prefetch" href="/assets/Routine1_pattern-matching-for-extraction.html.4581b4a7.js"><link rel="prefetch" href="/assets/Advanced-1.html.8d2432f5.js"><link rel="prefetch" href="/assets/Advanced-2.html.e6b41dcd.js"><link rel="prefetch" href="/assets/Advanced-3.html.02c0f8ee.js"><link rel="prefetch" href="/assets/Advanced-4.html.bae0f87a.js"><link rel="prefetch" href="/assets/Advanced-5.html.ef54bdb7.js"><link rel="prefetch" href="/assets/Extended-article-1.html.6527bd62.js"><link rel="prefetch" href="/assets/base-1.html.a43c4fd1.js"><link rel="prefetch" href="/assets/base-10.html.d0831bd8.js"><link rel="prefetch" href="/assets/base-11.html.4496f83d.js"><link rel="prefetch" href="/assets/base-12.html.79832c6a.js"><link rel="prefetch" href="/assets/base-13.html.4bf60c07.js"><link rel="prefetch" href="/assets/base-14.html.d79f3cc0.js"><link rel="prefetch" href="/assets/base-15.html.dc3b02fd.js"><link rel="prefetch" href="/assets/base-16.html.1a6b056d.js"><link rel="prefetch" href="/assets/base-17.html.676ddfa7.js"><link rel="prefetch" href="/assets/base-2.html.b4e3e3bb.js"><link rel="prefetch" href="/assets/base-3.html.7cf0e88c.js"><link rel="prefetch" href="/assets/base-4.html.0563ab94.js"><link rel="prefetch" href="/assets/base-5.html.f5a97bbe.js"><link rel="prefetch" href="/assets/base-6.html.3804d797.js"><link rel="prefetch" href="/assets/base-7.html.02a73438.js"><link rel="prefetch" href="/assets/base-8.html.54b87968.js"><link rel="prefetch" href="/assets/base-9.html.b28caa5b.js"><link rel="prefetch" href="/assets/rollup-1.html.a09cc8f8.js"><link rel="prefetch" href="/assets/rollup-10.html.380c6c94.js"><link rel="prefetch" href="/assets/rollup-11.html.dbc44e7c.js"><link rel="prefetch" href="/assets/rollup-2.html.34b3a1ef.js"><link rel="prefetch" href="/assets/rollup-3.html.bcde5ca1.js"><link rel="prefetch" href="/assets/rollup-4.html.8ab5da20.js"><link rel="prefetch" href="/assets/rollup-5.html.d5f10cc2.js"><link rel="prefetch" href="/assets/rollup-6.html.2caef2ac.js"><link rel="prefetch" href="/assets/rollup-7.html.4fe74d70.js"><link rel="prefetch" href="/assets/rollup-8.html.022d94fd.js"><link rel="prefetch" href="/assets/rollup-9.html.d33d4d29.js"><link rel="prefetch" href="/assets/scope-closures-appA.html.859f030a.js"><link rel="prefetch" href="/assets/scope-closures-appB.html.a0447478.js"><link rel="prefetch" href="/assets/scope-closures-appC.html.fccb9bd0.js"><link rel="prefetch" href="/assets/this-object-prototype-appA.html.619d20c0.js"><link rel="prefetch" href="/assets/async-performance-apA.html.64f96d6a.js"><link rel="prefetch" href="/assets/async-performance-apB.html.f2d9dbc0.js"><link rel="prefetch" href="/assets/async-performance-ch1.html.3bc9cccc.js"><link rel="prefetch" href="/assets/async-performance-ch2.html.b77c330c.js"><link rel="prefetch" href="/assets/async-performance-ch3.html.c5827605.js"><link rel="prefetch" href="/assets/async-performance-ch4.html.ad52181d.js"><link rel="prefetch" href="/assets/async-performance-ch5.html.0a596a07.js"><link rel="prefetch" href="/assets/async-performance-ch6.html.e8dec630.js"><link rel="prefetch" href="/assets/types-grammar-1.html.d89fd0a1.js"><link rel="prefetch" href="/assets/types-grammar-2.html.96e6de3c.js"><link rel="prefetch" href="/assets/types-grammar-3.html.87ee510d.js"><link rel="prefetch" href="/assets/types-grammar-4.html.952854e5.js"><link rel="prefetch" href="/assets/types-grammar-5.html.44b27133.js"><link rel="prefetch" href="/assets/types-grammar-apA.html.f2ab8088.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/1.1.hello-world.html.6b32ee7f.js"><link rel="prefetch" href="/assets/1.10.if.html.a30b50ce.js"><link rel="prefetch" href="/assets/1.11.includes.html.917fecad.js"><link rel="prefetch" href="/assets/1.12.parameters.html.dd7eb513.js"><link rel="prefetch" href="/assets/1.13.push.html.067470a0.js"><link rel="prefetch" href="/assets/1.14.unshift.html.475666e8.js"><link rel="prefetch" href="/assets/1.2.Pick.html.31b62876.js"><link rel="prefetch" href="/assets/1.3.Awaited.html.fd475d3d.js"><link rel="prefetch" href="/assets/1.4.Readonly.html.7a7189dd.js"><link rel="prefetch" href="/assets/1.5.Tuple-to-object.html.a53be02d.js"><link rel="prefetch" href="/assets/1.6.First-of-array.html.0782c3f7.js"><link rel="prefetch" href="/assets/1.7.Length-of-Tuple.html.9e1fd19e.js"><link rel="prefetch" href="/assets/1.8.concat.html.1cf3343a.js"><link rel="prefetch" href="/assets/1.9.exclude.html.4c2ecd0a.js"><link rel="prefetch" href="/assets/2.1.Get-Return-Type.html.b975c251.js"><link rel="prefetch" href="/assets/2.2.omit.html.5ddbebba.js"><link rel="prefetch" href="/assets/2.3.Readonly2.html.b74d9d13.js"><link rel="prefetch" href="/assets/2.4.Deep-Readonly.html.82d5b3e0.js"><link rel="prefetch" href="/assets/2.5.turn-to-union.html.1f80ce3a.js"><link rel="prefetch" href="/assets/3.1.Simple-Vue.html.70a89768.js"><link rel="prefetch" href="/assets/basic-1.html.149ea828.js"><link rel="prefetch" href="/assets/basic-2.html.ca98104f.js"><link rel="prefetch" href="/assets/basic-3.html.80c2b0ef.js"><link rel="prefetch" href="/assets/http-2.html.9de4c236.js"><link rel="prefetch" href="/assets/http-3.html.09bd38c0.js"><link rel="prefetch" href="/assets/http-interview.html.1148894c.js"><link rel="prefetch" href="/assets/http-rpc.html.8332fee1.js"><link rel="prefetch" href="/assets/http-websocket.html.47ad85db.js"><link rel="prefetch" href="/assets/https-ecdhe.html.e91cfb43.js"><link rel="prefetch" href="/assets/https-optimize.html.8d39b884.js"><link rel="prefetch" href="/assets/https-rsa.html.0ee93ec3.js"><link rel="prefetch" href="/assets/ip-base.html.f78389b5.js"><link rel="prefetch" href="/assets/ip-ping.html.076a41e0.js"><link rel="prefetch" href="/assets/ip-ping_io.html.2f830af1.js"><link rel="prefetch" href="/assets/tcp-challenge-ack.html.30a1640f.js"><link rel="prefetch" href="/assets/tcp-dump.html.bc00b56c.js"><link rel="prefetch" href="/assets/tcp-feature.html.447edc97.js"><link rel="prefetch" href="/assets/tcp-interview.html.ae96c119.js"><link rel="prefetch" href="/assets/tcp-isn-deff.html.6409b73d.js"><link rel="prefetch" href="/assets/tcp-optimize.html.7c31235c.js"><link rel="prefetch" href="/assets/tcp-out-of-order-fin.html.1c3be459.js"><link rel="prefetch" href="/assets/tcp-queue.html.b16b276a.js"><link rel="prefetch" href="/assets/tcp-stream.html.79811e94.js"><link rel="prefetch" href="/assets/tcp-syn.html.b9ff2183.js"><link rel="prefetch" href="/assets/donate.html.5ff8f8b2.js"><link rel="prefetch" href="/assets/Routine1_pattern-matching-for-extraction.html.3cb62a86.js"><link rel="prefetch" href="/assets/Advanced-1.html.a9f96920.js"><link rel="prefetch" href="/assets/Advanced-2.html.8bf53bf0.js"><link rel="prefetch" href="/assets/Advanced-3.html.930ef532.js"><link rel="prefetch" href="/assets/Advanced-4.html.6d1670c8.js"><link rel="prefetch" href="/assets/Advanced-5.html.da74c914.js"><link rel="prefetch" href="/assets/Extended-article-1.html.28b64e88.js"><link rel="prefetch" href="/assets/base-1.html.10097d3f.js"><link rel="prefetch" href="/assets/base-10.html.4a94d3cd.js"><link rel="prefetch" href="/assets/base-11.html.b7603498.js"><link rel="prefetch" href="/assets/base-12.html.6e443502.js"><link rel="prefetch" href="/assets/base-13.html.452c1c73.js"><link rel="prefetch" href="/assets/base-14.html.2e06baba.js"><link rel="prefetch" href="/assets/base-15.html.ecafd016.js"><link rel="prefetch" href="/assets/base-16.html.010cddba.js"><link rel="prefetch" href="/assets/base-17.html.a2d9bdd2.js"><link rel="prefetch" href="/assets/base-2.html.57994479.js"><link rel="prefetch" href="/assets/base-3.html.c5132b69.js"><link rel="prefetch" href="/assets/base-4.html.ab60619e.js"><link rel="prefetch" href="/assets/base-5.html.bfea0c7b.js"><link rel="prefetch" href="/assets/base-6.html.90ac203e.js"><link rel="prefetch" href="/assets/base-7.html.13524081.js"><link rel="prefetch" href="/assets/base-8.html.4776e28c.js"><link rel="prefetch" href="/assets/base-9.html.9f80d955.js"><link rel="prefetch" href="/assets/rollup-1.html.2cdd8e14.js"><link rel="prefetch" href="/assets/rollup-10.html.ea13c41b.js"><link rel="prefetch" href="/assets/rollup-11.html.5624634f.js"><link rel="prefetch" href="/assets/rollup-2.html.0c0b9295.js"><link rel="prefetch" href="/assets/rollup-3.html.58a2f1c5.js"><link rel="prefetch" href="/assets/rollup-4.html.151de338.js"><link rel="prefetch" href="/assets/rollup-5.html.4f8a64e7.js"><link rel="prefetch" href="/assets/rollup-6.html.6eb27e8e.js"><link rel="prefetch" href="/assets/rollup-7.html.16470a16.js"><link rel="prefetch" href="/assets/rollup-8.html.edc2c3d9.js"><link rel="prefetch" href="/assets/rollup-9.html.f5589eac.js"><link rel="prefetch" href="/assets/scope-closures-appA.html.2ed34ab1.js"><link rel="prefetch" href="/assets/scope-closures-appB.html.49b03091.js"><link rel="prefetch" href="/assets/scope-closures-appC.html.654e0db6.js"><link rel="prefetch" href="/assets/this-object-prototype-appA.html.badd495b.js"><link rel="prefetch" href="/assets/async-performance-apA.html.f8358188.js"><link rel="prefetch" href="/assets/async-performance-apB.html.26418b76.js"><link rel="prefetch" href="/assets/async-performance-ch1.html.f2c7e589.js"><link rel="prefetch" href="/assets/async-performance-ch2.html.1bee35ef.js"><link rel="prefetch" href="/assets/async-performance-ch3.html.5c60e4af.js"><link rel="prefetch" href="/assets/async-performance-ch4.html.0f54e284.js"><link rel="prefetch" href="/assets/async-performance-ch5.html.aa5fe27e.js"><link rel="prefetch" href="/assets/async-performance-ch6.html.539cebfb.js"><link rel="prefetch" href="/assets/types-grammar-1.html.97fdf006.js"><link rel="prefetch" href="/assets/types-grammar-2.html.e3a0371a.js"><link rel="prefetch" href="/assets/types-grammar-3.html.522bd1ea.js"><link rel="prefetch" href="/assets/types-grammar-4.html.49220150.js"><link rel="prefetch" href="/assets/types-grammar-5.html.fcf911de.js"><link rel="prefetch" href="/assets/types-grammar-apA.html.bac17dde.js"><link rel="prefetch" href="/assets/404.html.a850b954.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">HTTP/1.1 如何优化？ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#如何避免发送-http-请求" class="router-link-active router-link-exact-active sidebar-item" aria-label="如何避免发送 HTTP 请求？"><!--[--><!--]--> 如何避免发送 HTTP 请求？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#如何减少-http-请求次数" class="router-link-active router-link-exact-active sidebar-item" aria-label="如何减少 HTTP 请求次数？"><!--[--><!--]--> 如何减少 HTTP 请求次数？ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#减少重定向请求次数" class="router-link-active router-link-exact-active sidebar-item" aria-label="减少重定向请求次数"><!--[--><!--]--> 减少重定向请求次数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#合并请求" class="router-link-active router-link-exact-active sidebar-item" aria-label="合并请求"><!--[--><!--]--> 合并请求 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#延迟发送请求" class="router-link-active router-link-exact-active sidebar-item" aria-label="延迟发送请求"><!--[--><!--]--> 延迟发送请求 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#如何减少-http-响应的数据大小" class="router-link-active router-link-exact-active sidebar-item" aria-label="如何减少 HTTP 响应的数据大小？"><!--[--><!--]--> 如何减少 HTTP 响应的数据大小？ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#无损压缩" class="router-link-active router-link-exact-active sidebar-item" aria-label="无损压缩"><!--[--><!--]--> 无损压缩 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#有损压缩" class="router-link-active router-link-exact-active sidebar-item" aria-label="有损压缩"><!--[--><!--]--> 有损压缩 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/graphicalNetwork/http-optimize.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="http-1-1-如何优化" tabindex="-1"><a class="header-anchor" href="#http-1-1-如何优化" aria-hidden="true">#</a> HTTP/1.1 如何优化？</h1><p>问你一句：「<strong>你知道 HTTP/1.1 该如何优化吗？</strong>」</p><p>我们可以从下面这三种优化思路来优化 HTTP/1.1 协议：</p><ul><li><em>尽量避免发送 HTTP 请求</em>；</li><li><em>在需要发送 HTTP 请求时，考虑如何减少请求次数</em>；</li><li><em>减少服务器的 HTTP 响应的数据大小</em>；</li></ul><p>下面，就针对这三种思路具体看看有哪些优化方法。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/优化http1.1提纲.png" alt=""></p><hr><h2 id="如何避免发送-http-请求" tabindex="-1"><a class="header-anchor" href="#如何避免发送-http-请求" aria-hidden="true">#</a> 如何避免发送 HTTP 请求？</h2><p>这个思路你看到是不是觉得很奇怪，不发送 HTTP 请求，那客户端还怎么和服务器交互数据？小林你这不是耍流氓嘛？</p><p>冷静冷静，你说的没错，客户端当然要向服务器发送请求的。</p><p>但是，对于一些具有重复性的 HTTP 请求，比如每次请求得到的数据都一样的，我们可以把这对「请求-响应」的数据都<strong>缓存在本地</strong>，那么下次就直接读取本地的数据，不必在通过网络获取服务器的响应了，这样的话 HTTP/1.1 的性能肯定肉眼可见的提升。</p><p>所以，避免发送 HTTP 请求的方法就是通过<strong>缓存技术</strong>，HTTP 设计者早在之前就考虑到了这点，因此 HTTP 协议的头部有不少是针对缓存的字段。</p><p>那缓存是如何做到的呢？</p><p>客户端会把第一次请求以及响应的数据保存在本地磁盘上，其中将请求的 URL 作为 key，而响应作为 value，两者形成映射关系。</p><p>这样当后续发起相同的请求时，就可以先在本地磁盘上通过 key 查到对应的 value，也就是响应，如果找到了，就直接从本地读取该响应。毋庸置疑，读取本地磁盘的速度肯定比网络请求快得多，如下图：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/缓存访问.png" alt=""></p><p>聪明的你可能想到了，万一缓存的响应不是最新的，而客户端并不知情，那么该怎么办呢？</p><p>放心，这个问题 HTTP 设计者早已考虑到。</p><p>所以，服务器在发送 HTTP 响应时，会估算一个过期的时间，并把这个信息放到响应头部中，这样客户端在查看响应头部的信息时，一旦发现缓存的响应是过期的，则就会重新发送网络请求。</p><p>如果客户端从第一次请求得到的响应头部中发现该响应过期了，客户端重新发送请求，假设服务器上的资源并没有变更，还是老样子，那么你觉得还要在服务器的响应带上这个资源吗？</p><p>很显然不带的话，可以提高 HTTP 协议的性能，那具体如何做到呢？</p><p>只需要客户端在重新发送请求时，在请求的 <code>Etag</code> 头部带上第一次请求的响应头部中的摘要，这个摘要是唯一标识响应的资源，当服务器收到请求后，会将本地资源的摘要与请求中的摘要做个比较。</p><p>如果不同，那么说明客户端的缓存已经没有价值，服务器在响应中带上最新的资源。</p><p>如果相同，说明客户端的缓存还是可以继续使用的，那么服务器<strong>仅返回不含有包体的 <code>304 Not Modified</code> 响应</strong>，告诉客户端仍然有效，这样就可以减少响应资源在网络中传输的延时，如下图：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/缓存etag.png" alt=""></p><p>缓存真的是性能优化的一把万能钥匙，小到 CPU Cache、Page Cache、Redis Cache，大到 HTTP 协议的缓存。</p><hr><h2 id="如何减少-http-请求次数" tabindex="-1"><a class="header-anchor" href="#如何减少-http-请求次数" aria-hidden="true">#</a> 如何减少 HTTP 请求次数？</h2><p>减少 HTTP 请求次数自然也就提升了 HTTP 性能，可以从这 3 个方面入手：</p><ul><li><em>减少重定向请求次数</em>；</li><li><em>合并请求</em>；</li><li><em>延迟发送请求</em>；</li></ul><h3 id="减少重定向请求次数" tabindex="-1"><a class="header-anchor" href="#减少重定向请求次数" aria-hidden="true">#</a> 减少重定向请求次数</h3><p>我们先来看看什么是<strong>重定向请求</strong>？</p><p>服务器上的一个资源可能由于迁移、维护等原因从 url1 移至 url2 后，而客户端不知情，它还是继续请求 url1，这时服务器不能粗暴地返回错误，而是通过 <code>302</code> 响应码和 <code>Location</code> 头部，告诉客户端该资源已经迁移至 url2 了，于是客户端需要再发送 url2 请求以获得服务器的资源。</p><p>那么，如果重定向请求越多，那么客户端就要多次发起 HTTP 请求，每一次的 HTTP 请求都得经过网络，这无疑会越降低网络性能。</p><p>另外，服务端这一方往往不只有一台服务器，比如源服务器上一级是代理服务器，然后代理服务器才与客户端通信，这时客户端重定向就会导致客户端与代理服务器之间需要 2 次消息传递，如下图：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/客户端重定向.png" alt=""></p><p>如果<strong>重定向的工作交由代理服务器完成，就能减少 HTTP 请求次数了</strong>，如下图：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/代理服务器重定向.png" alt=""></p><p>而且当代理服务器知晓了重定向规则后，可以进一步减少消息传递次数，如下图：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/代理服务器重定向2.png" alt=""></p><p>除了 <code>302</code> 重定向响应码，还有其他一些重定向的响应码，你可以从下图看到：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/重定向响应码.png" alt=""></p><p>其中，<code>301</code> 和 <code>308</code> 响应码是告诉客户端可以将重定向响应缓存到本地磁盘，之后客户端就自动用 url2 替代 url1 访问服务器的资源。</p><h3 id="合并请求" tabindex="-1"><a class="header-anchor" href="#合并请求" aria-hidden="true">#</a> 合并请求</h3><p>如果把多个访问小文件的请求合并成一个大的请求，虽然传输的总资源还是一样，但是减少请求，也就意味着<strong>减少了重复发送的 HTTP 头部</strong>。</p><p>另外由于 HTTP/1.1 是请求响应模型，如果第一个发送的请求，未收到对应的响应，那么后续的请求就不会发送（PS：HTTP/1.1 管道模式是默认不使用的，所以讨论 HTTP/1.1 的队头阻塞问题，是不考虑管道模式的），于是为了防止单个请求的阻塞，所以<strong>一般浏览器会同时发起 5-6 个请求，每一个请求都是不同的 TCP 连接</strong>，那么如果合并了请求，也就会<strong>减少 TCP 连接的数量，因而省去了 TCP 握手和慢启动过程耗费的时间</strong>。</p><p>接下来，具体看看合并请求的几种方式。</p><p>有的网页会含有很多小图片、小图标，有多少个小图片，客户端就要发起多少次请求。那么对于这些小图片，我们可以考虑使用 <code>CSS Image Sprites</code> 技术把它们合成一个大图片，这样浏览器就可以用一次请求获得一个大图片，然后再根据 CSS 数据把大图片切割成多张小图片。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/css精灵.png" alt="图来源于：墨染枫林的CSDN"></p><p>这种方式就是<strong>通过将多个小图片合并成一个大图片来减少 HTTP 请求的次数，以减少 HTTP 请求的次数，从而减少网络的开销</strong>。</p><p>除了将小图片合并成大图片的方式，还有服务端使用 <code>webpack</code> 等打包工具将 js、css 等资源合并打包成大文件，也是能达到类似的效果。</p><p>另外，还可以将图片的二进制数据用 <code>base64</code> 编码后，以 URL 的形式嵌入到 HTML 文件，跟随 HTML 文件一并发送.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;image src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAFKCAIAAAC7M9WrAAAACXBIWXMAA ... /&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样客户端收到 HTML 后，就可以直接解码出数据，然后直接显示图片，就不用再发起图片相关的请求，这样便减少了请求的次数。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/base64图片.png" alt="图来源于：陈健平的CSDN "></p><p>可以看到，<strong>合并请求的方式就是合并资源，以一个大资源的请求替换多个小资源的请求</strong>。</p><p>但是这样的合并请求会带来新的问题，<strong>当大资源中的某一个小资源发生变化后，客户端必须重新下载整个完整的大资源文件</strong>，这显然带来了额外的网络消耗。</p><h3 id="延迟发送请求" tabindex="-1"><a class="header-anchor" href="#延迟发送请求" aria-hidden="true">#</a> 延迟发送请求</h3><p>不要一口气吃成大胖子，一般 HTML 里会含有很多 HTTP 的 URL，当前不需要的资源，我们没必要也获取过来，于是可以通过「<strong>按需获取</strong>」的方式，来减少第一时间的 HTTP 请求次数。</p><p>请求网页的时候，没必要把全部资源都获取到，而是只获取当前用户所看到的页面资源，当用户向下滑动页面的时候，再向服务器获取接下来的资源，这样就达到了延迟发送请求的效果。</p><hr><h2 id="如何减少-http-响应的数据大小" tabindex="-1"><a class="header-anchor" href="#如何减少-http-响应的数据大小" aria-hidden="true">#</a> 如何减少 HTTP 响应的数据大小？</h2><p>对于 HTTP 的请求和响应，通常 HTTP 的响应的数据大小会比较大，也就是服务器返回的资源会比较大。</p><p>于是，我们可以考虑对响应的资源进行<strong>压缩</strong>，这样就可以减少响应的数据大小，从而提高网络传输的效率。</p><p>压缩的方式一般分为 2 种，分别是：</p><ul><li><em>无损压缩</em>；</li><li><em>有损压缩</em>；</li></ul><h3 id="无损压缩" tabindex="-1"><a class="header-anchor" href="#无损压缩" aria-hidden="true">#</a> 无损压缩</h3><p>无损压缩是指资源经过压缩后，信息不被破坏，还能完全恢复到压缩前的原样，适合用在文本文件、程序可执行文件、程序源代码。</p><p>首先，我们针对代码的语法规则进行压缩，因为通常代码文件都有很多换行符或者空格，这些是为了帮助程序员更好的阅读，但是机器执行时并不要这些符，把这些多余的符号给去除掉。</p><p>接下来，就是无损压缩了，需要对原始资源建立统计模型，利用这个统计模型，将常出现的数据用较短的二进制比特序列表示，将不常出现的数据用较长的二进制比特序列表示，生成二进制比特序列一般是「霍夫曼编码」算法。</p><p>gzip 就是比较常见的无损压缩。客户端支持的压缩算法，会在 HTTP 请求中通过头部中的 <code>Accept-Encoding</code> 字段告诉服务器：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Accept-Encoding: gzip, deflate, br
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>服务器收到后，会从中选择一个服务器支持的或者合适的压缩算法，然后使用此压缩算法对响应资源进行压缩，最后通过响应头部中的 <code>Content-Encoding</code> 字段告诉客户端该资源使用的压缩算法。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Content-Encoding: gzip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>gzip 的压缩效率相比 Google 推出的 Brotli 算法还是差点意思，也就是上文中的 br，所以如果可以，服务器应该选择压缩效率更高的 br 压缩算法。</p><h3 id="有损压缩" tabindex="-1"><a class="header-anchor" href="#有损压缩" aria-hidden="true">#</a> 有损压缩</h3><p>与无损压缩相对的就是有损压缩，经过此方法压缩，解压的数据会与原始数据不同但是非常接近。</p><p>有损压缩主要将次要的数据舍弃，牺牲一些质量来减少数据量、提高压缩比，这种方法经常用于压缩多媒体数据，比如音频、视频、图片。</p><p>可以通过 HTTP 请求头部中的 <code>Accept</code> 字段里的「 q 质量因子」，告诉服务器期望的资源质量。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Accept: audio/*; q=0.2, audio/basic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>关于图片的压缩，目前压缩比较高的是 Google 推出的 <strong>WebP 格式</strong>，它与常见的 Png 格式图片的压缩比例对比如下图：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/http1.1优化/webp与png.png" alt="来源于：https://isparta.github.io/compare-webp/index.html"></p><p>可以发现，相同图片质量下，WebP 格式的图片大小都比 Png 格式的图片小，所以对于大量图片的网站，可以考虑使用 WebP 格式的图片，这将大幅度提升网络传输的性能。</p><p>关于音视频的压缩，音视频主要是动态的，每个帧都有时序的关系，通常时间连续的帧之间的变化是很小的。</p><p>比如，一个在看书的视频，画面通常只有人物的手和书桌上的书是会有变化的，而其他地方通常都是静态的，于是只需要在一个静态的关键帧，使用<strong>增量数据</strong>来表达后续的帧，这样便减少了很多数据，提高了网络传输的性能。对于视频常见的编码格式有 H264、H265 等，音频常见的编码格式有 AAC、AC3。</p><hr><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>这次主要从 3 个方面介绍了优化 HTTP/1.1 协议的思路。</p><p>第一个思路是，通过缓存技术来避免发送 HTTP 请求。客户端收到第一个请求的响应后，可以将其缓存在本地磁盘，下次请求的时候，如果缓存没过期，就直接读取本地缓存的响应数据。如果缓存过期，客户端发送请求的时候带上响应数据的摘要，服务器比对后发现资源没有变化，就发出不带包体的 304 响应，告诉客户端缓存的响应仍然有效。</p><p>第二个思路是，减少 HTTP 请求的次数，有以下的方法：</p><ol><li>将原本由客户端处理的重定向请求，交给代理服务器处理，这样可以减少重定向请求的次数；</li><li>将多个小资源合并成一个大资源再传输，能够减少 HTTP 请求次数以及 头部的重复传输，再来减少 TCP 连接数量，进而省去 TCP 握手和慢启动的网络消耗；</li><li>按需访问资源，只访问当前用户看得到/用得到的资源，当客户往下滑动，再访问接下来的资源，以此达到延迟请求，也就减少了同一时间的 HTTP 请求次数。</li></ol><p>第三思路是，通过压缩响应资源，降低传输资源的大小，从而提高传输效率，所以应当选择更优秀的压缩算法。</p><p>不管怎么优化 HTTP/1.1 协议都是有限的，不然也不会出现 HTTP/2 和 HTTP/3 协议，后续我们再来介绍 HTTP/2 和 HTTP/3 协议。</p><p>好了，此次分享到这就结束了，如果这篇文章对你有帮助，欢迎来个三连，你们的支持就是小林的最大动力，我们下次见！</p><hr><p>参考资料：</p><ol><li>https://isparta.github.io/compare-webp/index.html</li><li>https://zh.wikipedia.org/wiki/https://en.wikipedia.org/wiki/Lossy_compression</li><li>https://en.wikipedia.org/wiki/Lossless_compression</li><li>https://time.geekbang.org/column/article/242667</li><li>https://www.tutorialrepublic.com/css-tutorial/css-sprites.php</li><li>https://blog.csdn.net/weixin_38055381/article/details/81504716</li><li>https://blog.csdn.net/weixin_44151887/article/details/106278559</li></ol><hr></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1453300745@qq.com">wangtao</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.2732c273.js" defer></script>
  </body>
</html>
