<template><div><h2 id="é¢˜ç›®" tabindex="-1"><a class="header-anchor" href="#é¢˜ç›®" aria-hidden="true">#</a> é¢˜ç›®</h2>
<p>å®ç°ä¸€ä¸ªé€šç”¨ <code v-pre>MyReadonly2&lt;T, K&gt;</code>ï¼Œå®ƒå¸¦æœ‰ä¸¤ç§ç±»å‹çš„å‚æ•° <code v-pre>T</code> å’Œ <code v-pre>K</code>ã€‚</p>
<p><code v-pre>K</code> æŒ‡å®šåº”è®¾ç½®ä¸º <code v-pre>Readonly</code> çš„ <code v-pre>T</code> çš„å±æ€§é›†ã€‚å¦‚æœæœªæä¾›<code v-pre> K</code>ï¼Œåˆ™åº”ä½¿æ‰€æœ‰å±æ€§éƒ½å˜ä¸ºåªè¯»ï¼Œå°±åƒæ™®é€šçš„ <code v-pre>Readonly&lt;T&gt;</code>ä¸€æ ·ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="language-typescript ext-ts line-numbers-mode"><pre v-pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  completed<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> todo<span class="token operator">:</span> MyReadonly2<span class="token operator">&lt;</span>Todo<span class="token punctuation">,</span> <span class="token string">"title"</span> <span class="token operator">|</span> <span class="token string">"description"</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">"Hey"</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">"foobar"</span><span class="token punctuation">,</span>
  completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

todo<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span> <span class="token comment">// Error: cannot reassign a readonly property</span>
todo<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">"barFoo"</span><span class="token punctuation">;</span> <span class="token comment">// Error: cannot reassign a readonly property</span>
todo<span class="token punctuation">.</span>completed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p align='left'>
  ç‚¹å‡»githubæŸ¥çœ‹ï¼š
  <a href='https://github.com/W-HanYu/FE-Typescript/blob/master/vuepress/docs/challenge/2.3.Readonly2.md'>
    <img src='https://img.shields.io/badge/Github-1.8k+-143?logo=typescript&color=3178C6&logoColor=fff' />
  </a>
</p>
<h2 id="æŒ‘æˆ˜" tabindex="-1"><a class="header-anchor" href="#æŒ‘æˆ˜" aria-hidden="true">#</a> æŒ‘æˆ˜</h2>
<p>::: info æç¤º
åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œä½ éœ€è¦ä¿®æ”¹ä¸‹æ–¹çš„ä»£ç ä½¿å¾—æµ‹è¯•é€šè¿‡ï¼ˆä½¿å…¶æ²¡æœ‰ç±»å‹é”™è¯¯ï¼‰ã€‚å¹¶ä¸”è®°å¾—å°†ç­”æ¡ˆåˆ†äº«å¥¥ã€‚
:::</p>
<CodeBox surl="https://stackblitz.com/edit/typescript-wgcecz?embed=1&file=2.3.Readonly2.ts&hideExplorer=1&hideNavigation=1&theme=dark&view=editor" /><!--info-footer-start--><br> <a href="https://github.com/W-HanYu/FE-Typescript/issues/new?assignees=Ustinian&labels=answer&template=2-3-%E5%AE%9E%E7%8E%B0Readonly2.md&title=2-3-%E5%AE%9E%E7%8E%B0Readonly2.md" target="_blank"><img src="https://6d78-mxm1923893223-ulteh-1302287111.tcb.qcloud.la/-åˆ†äº«ä½ çš„è§£ç­”-teal.svg?sign=8bb2a2a3bd2b1cc8f86bfd919d53197e&t=1668143704" alt="åˆ†äº«ä½ çš„è§£ç­”"/></a>  <!--info-footer-end-->
<h2 id="è§£æ" tabindex="-1"><a class="header-anchor" href="#è§£æ" aria-hidden="true">#</a> è§£æ</h2>
<p>è¿™ä¸ªæŒ‘æˆ˜æ˜¯ <code v-pre>Readonly&lt;T&gt;</code>æŒ‘æˆ˜çš„å»¶ç»­ï¼Œé™¤äº†éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ç±»å‹å‚æ•° <code v-pre>K</code>ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ å°†æŒ‡å®šçš„å±æ€§è®¾ä¸ºåªè¯»å¤–ï¼Œä¸€åˆ‡éƒ½åŸºæœ¬ç›¸åŒã€‚</p>
<p>æˆ‘ä»¬ä»æœ€ç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œå³ K æ˜¯ä¸€ä¸ªç©ºé›†åˆï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•å±æ€§éœ€è¦è®¾ç½®ä¸ºåªè¯»ã€‚æˆ‘ä»¬ åªéœ€è¦è¿”å› T å°±å¥½äº†ã€‚</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>type MyReadonly2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬éœ€è¦å¤„ç†è¿™æ ·ä¸€ç§æƒ…å†µï¼šå³åœ¨ K ä¸­æä¾›å¯¹åº”å±æ€§ï¼Œæˆ‘ä»¬åˆ©ç”¨&amp;æ“ä½œç¬¦ä½¿ä¸¤ç§ç±»å‹ äº§ ç”Ÿäº¤é›†ï¼š ä¸€ä¸ªæ˜¯ä¹‹å‰æåˆ°çš„ç±»å‹ T,å¦ä¸€ä¸ªæ˜¯å«æœ‰åªè¯»å±æ€§çš„ç±»å‹ã€‚</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>type MyReadonly2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> readonly <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>çœ‹èµ·æ¥æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ <code v-pre>ï¼šType P cannot be used to index type T</code>ã€‚è¿™æ˜¯å¯¹çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¯¹ K è®¾ç½®çº¦ æŸï¼Œå®ƒåº”è¯¥æ˜¯ <code v-pre>â€œT ä¸­çš„æ¯ä¸€ä¸ªé”®â€</code> :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>type MyReadonly2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> readonly <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­£å¸¸å·¥ä½œå•¦? ğŸ™…â€ ä¸!</p>
<p>æˆ‘ä»¬è¿˜æ²¡æœ‰å¤„ç†å½“ K ä»€ä¹ˆéƒ½æ²¡æœ‰è®¾ç½®çš„æƒ…å†µï¼Œè¯¥æƒ…å†µä¸‹æˆ‘ä»¬çš„ç±»å‹å¿…é¡»å’Œé€šå¸¸ çš„ <code v-pre>Readonly&lt;T&gt;</code>è¡¨ç°å¾—ä¸€æ ·ã€‚ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°† K çš„é»˜è®¤å€¼è®¾ä¸ºâ€T çš„æ‰€æœ‰é”® â€œã€‚</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// solution-1</span>
type MyReadonly2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span> <span class="token operator">=</span> keyof <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
readonly <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// å³ï¼š</span>
type MyReadonly2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span> <span class="token operator">=</span> keyof <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">&amp;</span> Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ å¯èƒ½å‘ç° solution-1 åœ¨ TypeScript 4.5 åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºåŸæœ¬çš„è¡Œ ä¸ºåœ¨ <code v-pre>TypeScript</code> ä¸­æ˜¯ä¸€ä¸ª bugï¼ˆ åœ¨ microsoft/TypeScript#45122 ä¸­ åˆ—å‡ºï¼Œ åœ¨ <code v-pre>microsoft/TypeScript#45263</code> ä¸­ è¢«ä¿®å¤ï¼Œåœ¨ TypeScript 4.5 ç‰ˆæœ¬ä¸­æ­£å¼å‘å¸ƒï¼‰ã€‚ä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œäº¤å‰ç±»å‹æ„å‘³ç€ â€œä¸â€ï¼Œ å› æ­¤{readonly a: string} &amp; {a: string}ä¸{a: string}åº”è¯¥æ˜¯ç›¸ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å± æ€§ a æ˜¯å¯è¯»ä¸”å¯å†™çš„ã€‚</p>
<p>åœ¨ TypeScript 4.5 ä¹‹å‰ï¼Œ TypeScript æœ‰ç€ç›¸åçš„ä¸æ­£ç¡®çš„è¡Œä¸ºï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨äº¤å‰ç±»å‹ä¸­ ï¼Œä¸€äº›æˆå‘˜çš„å±æ€§æ˜¯åªè¯»çš„ï¼Œä½†åœ¨å¦å¤–æˆå‘˜ä¸­åŒåå±æ€§æ˜¯å¯è¯»å¯å†™çš„ï¼Œæœ€ç»ˆå¯¹è±¡çš„ç›¸åº”å±æ€§ å´æ˜¯åªè¯»çš„ï¼Œè¿™ç§è¡Œä¸ºæ˜¯ä¸æ­£ç¡®çš„ï¼Œä½†è¿™å·²ç»è¢«ä¿®å¤äº†ã€‚å› æ­¤è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ ä¹ˆ solution-1 ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">//Solution-2</span>
type MyReadonly2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span> <span class="token operator">=</span> keyof <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
readonly <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//i.e.</span>
type MyReadonly2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span> <span class="token operator">=</span> keyof <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">&amp;</span> Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸º K ä¸­çš„é”®éƒ½æ²¡æœ‰åœ¨ <code v-pre>keyof Omit&lt;T, K&gt;</code>ä¸­å‡ºç°è¿‡ï¼Œå› æ­¤ <code v-pre>solution-2</code> èƒ½å¤Ÿå‘ç›¸åº”å±æ€§ æ·»åŠ  <code v-pre>readonly</code> ä¿®é¥°ç¬¦ã€‚</p>
<h2 id="å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒ" aria-hidden="true">#</a> å‚è€ƒ</h2>
<ul>
<li><a href="https://www.typescriptlang.org/docs/handbook/2/conditional-types.html" target="_blank" rel="noopener noreferrer">Conditional Types<ExternalLinkIcon/></a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html" target="_blank" rel="noopener noreferrer">Mapped Types<ExternalLinkIcon/></a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html" target="_blank" rel="noopener noreferrer">Index Types<ExternalLinkIcon/></a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html#key-remapping-in-mapped-types" target="_blank" rel="noopener noreferrer">Key remapping in mapped types<ExternalLinkIcon/></a></li>
</ul>
</div></template>


