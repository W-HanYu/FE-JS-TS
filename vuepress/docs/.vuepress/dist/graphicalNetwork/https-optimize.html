<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>HTTPS 如何优化？ | </title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.d6a6c857.js"><link rel="modulepreload" href="/assets/https-optimize.html.42e1a9da.js"><link rel="modulepreload" href="/assets/https-optimize.html.6a75aeb7.js"><link rel="prefetch" href="/assets/1.1.hello-world.html.c9c3a5a1.js"><link rel="prefetch" href="/assets/1.10.if.html.9e1b96da.js"><link rel="prefetch" href="/assets/1.11.includes.html.f730fd82.js"><link rel="prefetch" href="/assets/1.12.parameters.html.cea6009c.js"><link rel="prefetch" href="/assets/1.13.push.html.b4a2eefb.js"><link rel="prefetch" href="/assets/1.14.unshift.html.899e4793.js"><link rel="prefetch" href="/assets/1.2.Pick.html.00955fc1.js"><link rel="prefetch" href="/assets/1.3.Awaited.html.c28eb4dc.js"><link rel="prefetch" href="/assets/1.4.Readonly.html.5504219f.js"><link rel="prefetch" href="/assets/1.5.Tuple-to-object.html.e5ff4876.js"><link rel="prefetch" href="/assets/1.6.First-of-array.html.8963da96.js"><link rel="prefetch" href="/assets/1.7.Length-of-Tuple.html.b566373d.js"><link rel="prefetch" href="/assets/1.8.concat.html.e48cdb0f.js"><link rel="prefetch" href="/assets/1.9.exclude.html.a9065b1a.js"><link rel="prefetch" href="/assets/2.1.Get-Return-Type.html.fc63429d.js"><link rel="prefetch" href="/assets/2.2.omit.html.12f10b17.js"><link rel="prefetch" href="/assets/2.3.Readonly2.html.e66ac73b.js"><link rel="prefetch" href="/assets/2.4.Deep-Readonly.html.a658e6e6.js"><link rel="prefetch" href="/assets/2.5.turn-to-union.html.073cd259.js"><link rel="prefetch" href="/assets/3.1.Simple-Vue.html.99882d01.js"><link rel="prefetch" href="/assets/donate.html.acbabecd.js"><link rel="prefetch" href="/assets/basic-1.html.9eb41d9a.js"><link rel="prefetch" href="/assets/basic-2.html.f7caa9d2.js"><link rel="prefetch" href="/assets/basic-3.html.34aee1eb.js"><link rel="prefetch" href="/assets/http-2.html.787a8a96.js"><link rel="prefetch" href="/assets/http-3.html.34a30fe1.js"><link rel="prefetch" href="/assets/http-interview.html.ace5bf96.js"><link rel="prefetch" href="/assets/http-optimize.html.69d45db9.js"><link rel="prefetch" href="/assets/http-rpc.html.8491156f.js"><link rel="prefetch" href="/assets/http-websocket.html.7d4a1447.js"><link rel="prefetch" href="/assets/https-ecdhe.html.05368a85.js"><link rel="prefetch" href="/assets/https-rsa.html.f131cf25.js"><link rel="prefetch" href="/assets/ip-base.html.e6127d4e.js"><link rel="prefetch" href="/assets/ip-ping.html.6302a945.js"><link rel="prefetch" href="/assets/ip-ping_io.html.6c34496f.js"><link rel="prefetch" href="/assets/tcp-challenge-ack.html.3a5fc045.js"><link rel="prefetch" href="/assets/tcp-dump.html.b56080fb.js"><link rel="prefetch" href="/assets/tcp-feature.html.a3d828ae.js"><link rel="prefetch" href="/assets/tcp-interview.html.62d97690.js"><link rel="prefetch" href="/assets/tcp-isn-deff.html.82d20436.js"><link rel="prefetch" href="/assets/tcp-optimize.html.ca87f13b.js"><link rel="prefetch" href="/assets/tcp-out-of-order-fin.html.151c009d.js"><link rel="prefetch" href="/assets/tcp-queue.html.74d5129c.js"><link rel="prefetch" href="/assets/tcp-stream.html.e93bfa43.js"><link rel="prefetch" href="/assets/tcp-syn.html.d732a2c4.js"><link rel="prefetch" href="/assets/Routine1_pattern-matching-for-extraction.html.49a96cb6.js"><link rel="prefetch" href="/assets/Advanced-1.html.660aba6d.js"><link rel="prefetch" href="/assets/Advanced-2.html.768f0222.js"><link rel="prefetch" href="/assets/Advanced-3.html.80ef5874.js"><link rel="prefetch" href="/assets/Advanced-4.html.9ac82786.js"><link rel="prefetch" href="/assets/Advanced-5.html.7086659b.js"><link rel="prefetch" href="/assets/Extended-article-1.html.6684a3a3.js"><link rel="prefetch" href="/assets/base-1.html.a1a4a8f1.js"><link rel="prefetch" href="/assets/base-10.html.5a196727.js"><link rel="prefetch" href="/assets/base-11.html.aab11d1b.js"><link rel="prefetch" href="/assets/base-12.html.e5e162d6.js"><link rel="prefetch" href="/assets/base-13.html.e7f1ec06.js"><link rel="prefetch" href="/assets/base-14.html.7817c35c.js"><link rel="prefetch" href="/assets/base-15.html.234b3135.js"><link rel="prefetch" href="/assets/base-16.html.d8b75899.js"><link rel="prefetch" href="/assets/base-17.html.563cf78a.js"><link rel="prefetch" href="/assets/base-2.html.a766b26b.js"><link rel="prefetch" href="/assets/base-3.html.456ded6f.js"><link rel="prefetch" href="/assets/base-4.html.ad7f3656.js"><link rel="prefetch" href="/assets/base-5.html.d39095e5.js"><link rel="prefetch" href="/assets/base-6.html.b84ee494.js"><link rel="prefetch" href="/assets/base-7.html.178e9a4d.js"><link rel="prefetch" href="/assets/base-8.html.c0808088.js"><link rel="prefetch" href="/assets/base-9.html.208c7bb9.js"><link rel="prefetch" href="/assets/rollup-1.html.03002012.js"><link rel="prefetch" href="/assets/rollup-10.html.86a22541.js"><link rel="prefetch" href="/assets/rollup-11.html.e3a4642f.js"><link rel="prefetch" href="/assets/rollup-2.html.41d6ac3a.js"><link rel="prefetch" href="/assets/rollup-3.html.6ad17f68.js"><link rel="prefetch" href="/assets/rollup-4.html.7d4a4c3c.js"><link rel="prefetch" href="/assets/rollup-5.html.54596415.js"><link rel="prefetch" href="/assets/rollup-6.html.2de6134f.js"><link rel="prefetch" href="/assets/rollup-7.html.e1bb8ffd.js"><link rel="prefetch" href="/assets/rollup-8.html.1b8764c3.js"><link rel="prefetch" href="/assets/rollup-9.html.1d7bff01.js"><link rel="prefetch" href="/assets/scope-closures-appA.html.54460362.js"><link rel="prefetch" href="/assets/scope-closures-appB.html.df5a960f.js"><link rel="prefetch" href="/assets/scope-closures-appC.html.d19041c8.js"><link rel="prefetch" href="/assets/this-object-prototype-appA.html.a5e33133.js"><link rel="prefetch" href="/assets/async-performance-apA.html.1318a5e9.js"><link rel="prefetch" href="/assets/async-performance-apB.html.6a42c749.js"><link rel="prefetch" href="/assets/async-performance-ch1.html.43644825.js"><link rel="prefetch" href="/assets/async-performance-ch2.html.5569a916.js"><link rel="prefetch" href="/assets/async-performance-ch3.html.6eb4b5e0.js"><link rel="prefetch" href="/assets/async-performance-ch4.html.b1839a56.js"><link rel="prefetch" href="/assets/async-performance-ch5.html.9bd4d678.js"><link rel="prefetch" href="/assets/async-performance-ch6.html.04dbdb45.js"><link rel="prefetch" href="/assets/types-grammar-1.html.4b5e4a6d.js"><link rel="prefetch" href="/assets/types-grammar-2.html.09993b1d.js"><link rel="prefetch" href="/assets/types-grammar-3.html.d901835c.js"><link rel="prefetch" href="/assets/types-grammar-4.html.e85d4a5d.js"><link rel="prefetch" href="/assets/types-grammar-5.html.a2b81328.js"><link rel="prefetch" href="/assets/types-grammar-apA.html.2924c653.js"><link rel="prefetch" href="/assets/404.html.d2dc3323.js"><link rel="prefetch" href="/assets/1.1.hello-world.html.8889e1c3.js"><link rel="prefetch" href="/assets/1.10.if.html.9c992939.js"><link rel="prefetch" href="/assets/1.11.includes.html.c310d8a6.js"><link rel="prefetch" href="/assets/1.12.parameters.html.401de776.js"><link rel="prefetch" href="/assets/1.13.push.html.c8e9c8ed.js"><link rel="prefetch" href="/assets/1.14.unshift.html.691414f6.js"><link rel="prefetch" href="/assets/1.2.Pick.html.e50fab62.js"><link rel="prefetch" href="/assets/1.3.Awaited.html.6cf2378d.js"><link rel="prefetch" href="/assets/1.4.Readonly.html.a6f1d0d7.js"><link rel="prefetch" href="/assets/1.5.Tuple-to-object.html.cf185537.js"><link rel="prefetch" href="/assets/1.6.First-of-array.html.ed1df455.js"><link rel="prefetch" href="/assets/1.7.Length-of-Tuple.html.65115209.js"><link rel="prefetch" href="/assets/1.8.concat.html.2f237caa.js"><link rel="prefetch" href="/assets/1.9.exclude.html.7f0fd919.js"><link rel="prefetch" href="/assets/2.1.Get-Return-Type.html.76c56f80.js"><link rel="prefetch" href="/assets/2.2.omit.html.ec9eb85d.js"><link rel="prefetch" href="/assets/2.3.Readonly2.html.3f33285e.js"><link rel="prefetch" href="/assets/2.4.Deep-Readonly.html.0d2965f0.js"><link rel="prefetch" href="/assets/2.5.turn-to-union.html.e9c55e5f.js"><link rel="prefetch" href="/assets/3.1.Simple-Vue.html.bd8024cc.js"><link rel="prefetch" href="/assets/donate.html.2a5870fb.js"><link rel="prefetch" href="/assets/basic-1.html.b6ef6781.js"><link rel="prefetch" href="/assets/basic-2.html.c2671190.js"><link rel="prefetch" href="/assets/basic-3.html.5f3720be.js"><link rel="prefetch" href="/assets/http-2.html.bc5cefe5.js"><link rel="prefetch" href="/assets/http-3.html.93052ade.js"><link rel="prefetch" href="/assets/http-interview.html.b0b57c93.js"><link rel="prefetch" href="/assets/http-optimize.html.42727f1b.js"><link rel="prefetch" href="/assets/http-rpc.html.bec83293.js"><link rel="prefetch" href="/assets/http-websocket.html.c484715b.js"><link rel="prefetch" href="/assets/https-ecdhe.html.7c8ae5cf.js"><link rel="prefetch" href="/assets/https-rsa.html.15bdc76e.js"><link rel="prefetch" href="/assets/ip-base.html.f4386927.js"><link rel="prefetch" href="/assets/ip-ping.html.5e193a08.js"><link rel="prefetch" href="/assets/ip-ping_io.html.2e90f4dd.js"><link rel="prefetch" href="/assets/tcp-challenge-ack.html.e9de7a7a.js"><link rel="prefetch" href="/assets/tcp-dump.html.891aa651.js"><link rel="prefetch" href="/assets/tcp-feature.html.2ff95758.js"><link rel="prefetch" href="/assets/tcp-interview.html.c86c0c04.js"><link rel="prefetch" href="/assets/tcp-isn-deff.html.f879f3ba.js"><link rel="prefetch" href="/assets/tcp-optimize.html.87c8fb7d.js"><link rel="prefetch" href="/assets/tcp-out-of-order-fin.html.6bcc7f81.js"><link rel="prefetch" href="/assets/tcp-queue.html.628b80d2.js"><link rel="prefetch" href="/assets/tcp-stream.html.bed4ecbf.js"><link rel="prefetch" href="/assets/tcp-syn.html.fc9b4bfe.js"><link rel="prefetch" href="/assets/Routine1_pattern-matching-for-extraction.html.0135d9f4.js"><link rel="prefetch" href="/assets/Advanced-1.html.5641b3bf.js"><link rel="prefetch" href="/assets/Advanced-2.html.33e4f2ca.js"><link rel="prefetch" href="/assets/Advanced-3.html.f5ce8cfb.js"><link rel="prefetch" href="/assets/Advanced-4.html.48107ce5.js"><link rel="prefetch" href="/assets/Advanced-5.html.f223e71e.js"><link rel="prefetch" href="/assets/Extended-article-1.html.b4412a40.js"><link rel="prefetch" href="/assets/base-1.html.53d12ec9.js"><link rel="prefetch" href="/assets/base-10.html.7dc91ad9.js"><link rel="prefetch" href="/assets/base-11.html.343c313a.js"><link rel="prefetch" href="/assets/base-12.html.77ff3868.js"><link rel="prefetch" href="/assets/base-13.html.bb97c2ac.js"><link rel="prefetch" href="/assets/base-14.html.be8d6fab.js"><link rel="prefetch" href="/assets/base-15.html.d163b0a5.js"><link rel="prefetch" href="/assets/base-16.html.7abac5a7.js"><link rel="prefetch" href="/assets/base-17.html.088b9e71.js"><link rel="prefetch" href="/assets/base-2.html.b29f1520.js"><link rel="prefetch" href="/assets/base-3.html.65aa57e7.js"><link rel="prefetch" href="/assets/base-4.html.b7a8254c.js"><link rel="prefetch" href="/assets/base-5.html.be0e824c.js"><link rel="prefetch" href="/assets/base-6.html.2ef01200.js"><link rel="prefetch" href="/assets/base-7.html.b962edcc.js"><link rel="prefetch" href="/assets/base-8.html.c478ace2.js"><link rel="prefetch" href="/assets/base-9.html.f76bb92e.js"><link rel="prefetch" href="/assets/rollup-1.html.72309131.js"><link rel="prefetch" href="/assets/rollup-10.html.58c10bc0.js"><link rel="prefetch" href="/assets/rollup-11.html.a72ebd1d.js"><link rel="prefetch" href="/assets/rollup-2.html.9a76acfe.js"><link rel="prefetch" href="/assets/rollup-3.html.0915ffb6.js"><link rel="prefetch" href="/assets/rollup-4.html.0242567c.js"><link rel="prefetch" href="/assets/rollup-5.html.026d9d85.js"><link rel="prefetch" href="/assets/rollup-6.html.361fb771.js"><link rel="prefetch" href="/assets/rollup-7.html.ac26453b.js"><link rel="prefetch" href="/assets/rollup-8.html.5953afa8.js"><link rel="prefetch" href="/assets/rollup-9.html.4bb6fdbc.js"><link rel="prefetch" href="/assets/scope-closures-appA.html.8b46aa8c.js"><link rel="prefetch" href="/assets/scope-closures-appB.html.33961e52.js"><link rel="prefetch" href="/assets/scope-closures-appC.html.745a2e0d.js"><link rel="prefetch" href="/assets/this-object-prototype-appA.html.01bfb46b.js"><link rel="prefetch" href="/assets/async-performance-apA.html.08d40f5b.js"><link rel="prefetch" href="/assets/async-performance-apB.html.5cd8c442.js"><link rel="prefetch" href="/assets/async-performance-ch1.html.29a43e00.js"><link rel="prefetch" href="/assets/async-performance-ch2.html.83c3ebb4.js"><link rel="prefetch" href="/assets/async-performance-ch3.html.cd0adc0f.js"><link rel="prefetch" href="/assets/async-performance-ch4.html.4dd591fd.js"><link rel="prefetch" href="/assets/async-performance-ch5.html.603b3075.js"><link rel="prefetch" href="/assets/async-performance-ch6.html.51aa07a6.js"><link rel="prefetch" href="/assets/types-grammar-1.html.19785b70.js"><link rel="prefetch" href="/assets/types-grammar-2.html.3efa5487.js"><link rel="prefetch" href="/assets/types-grammar-3.html.712b344e.js"><link rel="prefetch" href="/assets/types-grammar-4.html.4b90397d.js"><link rel="prefetch" href="/assets/types-grammar-5.html.30bf1d6e.js"><link rel="prefetch" href="/assets/types-grammar-apA.html.10df458d.js"><link rel="prefetch" href="/assets/404.html.0dc21e74.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">HTTPS 如何优化？ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#分析性能损耗" class="router-link-active router-link-exact-active sidebar-item" aria-label="分析性能损耗"><!--[--><!--]--> 分析性能损耗 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#硬件优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="硬件优化"><!--[--><!--]--> 硬件优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#软件优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="软件优化"><!--[--><!--]--> 软件优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#协议优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="协议优化"><!--[--><!--]--> 协议优化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#密钥交换算法优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="密钥交换算法优化"><!--[--><!--]--> 密钥交换算法优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#tls-升级" class="router-link-active router-link-exact-active sidebar-item" aria-label="TLS 升级"><!--[--><!--]--> TLS 升级 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#证书优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="证书优化"><!--[--><!--]--> 证书优化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#证书传输优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="证书传输优化"><!--[--><!--]--> 证书传输优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#证书验证优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="证书验证优化"><!--[--><!--]--> 证书验证优化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#会话复用" class="router-link-active router-link-exact-active sidebar-item" aria-label="会话复用"><!--[--><!--]--> 会话复用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#session-id" class="router-link-active router-link-exact-active sidebar-item" aria-label="Session ID"><!--[--><!--]--> Session ID <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#session-ticket" class="router-link-active router-link-exact-active sidebar-item" aria-label="Session Ticket"><!--[--><!--]--> Session Ticket <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#pre-shared-key" class="router-link-active router-link-exact-active sidebar-item" aria-label="Pre-shared Key"><!--[--><!--]--> Pre-shared Key <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/graphicalNetwork/https-optimize.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="https-如何优化" tabindex="-1"><a class="header-anchor" href="#https-如何优化" aria-hidden="true">#</a> HTTPS 如何优化？</h1><p>由裸数据传输的 HTTP 协议转成加密数据传输的 HTTPS 协议，给应用数据套了个「保护伞」，提高安全性的同时也带来了性能消耗。</p><p>因为 HTTPS 相比 HTTP 协议多一个 TLS 协议握手过程，<strong>目的是为了通过非对称加密握手协商或者交换出对称加密密钥</strong>，这个过程最长可以花费掉 2 RTT，接着后续传输的应用数据都得使用对称加密密钥来加密/解密。</p><p>为了数据的安全性，我们不得不使用 HTTPS 协议，至今大部分网址都已从 HTTP 迁移至 HTTPS 协议，因此针对 HTTPS 的优化是非常重要的。</p><p>这次，就从多个角度来优化 HTTPS。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/优化https提纲.png" alt=""></p><hr><h2 id="分析性能损耗" tabindex="-1"><a class="header-anchor" href="#分析性能损耗" aria-hidden="true">#</a> 分析性能损耗</h2><p>既然要对 HTTPS 优化，那得清楚哪些步骤会产生性能消耗，再对症下药。</p><p>产生性能消耗的两个环节：</p><ul><li>第一个环节， TLS 协议握手过程；</li><li>第二个环节，握手后的对称加密报文传输。</li></ul><p>对于第二环节，现在主流的对称加密算法 AES、ChaCha20 性能都是不错的，而且一些 CPU 厂商还针对它们做了硬件级别的优化，因此这个环节的性能消耗可以说非常地小。</p><p>而第一个环节，TLS 协议握手过程不仅增加了网络延时（最长可以花费掉 2 RTT），而且握手过程中的一些步骤也会产生性能损耗，比如：</p><ul><li>对于 ECDHE 密钥协商算法，握手过程中会客户端和服务端都需要临时生成椭圆曲线公私钥；</li><li>客户端验证证书时，会访问 CA 获取 CRL 或者 OCSP，目的是验证服务器的证书是否有被吊销；</li><li>双方计算 Pre-Master，也就是对称加密密钥；</li></ul><p>为了大家更清楚这些步骤在 TLS 协议握手的哪一个阶段，我画出了这幅图：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/tls性能损耗.png" alt=""></p><hr><h2 id="硬件优化" tabindex="-1"><a class="header-anchor" href="#硬件优化" aria-hidden="true">#</a> 硬件优化</h2><p>玩游戏时，如果我们怎么都战胜不了对方，那么有一个最有效、最快的方式来变强，那就是「充钱」，如果还是不行，那说明你充的钱还不够多。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/充钱.jpg" alt=""></p><p>对于计算机里也是一样，软件都是跑在物理硬件上，硬件越牛逼，软件跑的也越快，所以如果要优化 HTTPS 优化，最直接的方式就是花钱买性能参数更牛逼的硬件。</p><p>但是花钱也要花对方向，<strong>HTTPS 协议是计算密集型，而不是 I/O 密集型</strong>，所以不能把钱花在网卡、硬盘等地方，应该花在 CPU 上。</p><p>一个好的 CPU，可以提高计算性能，因为 HTTPS 连接过程中就有大量需要计算密钥的过程，所以这样可以加速 TLS 握手过程。</p><p>另外，如果可以，应该选择可以<strong>支持 AES-NI 特性的 CPU</strong>，因为这种款式的 CPU 能在指令级别优化了 AES 算法，这样便加速了数据的加解密传输过程。</p><p>如果你的服务器是 Linux 系统，那么你可以使用下面这行命令查看 CPU 是否支持 AES-NI 指令集：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/aesni_intel.png" alt=""></p><p>如果我们的 CPU 支持 AES-NI 特性，那么对于对称加密的算法应该选择 AES 算法。否则可以选择 ChaCha20 对称加密算法，因为 ChaCha20 算法的运算指令相比 AES 算法会对 CPU 更友好一点。</p><hr><h2 id="软件优化" tabindex="-1"><a class="header-anchor" href="#软件优化" aria-hidden="true">#</a> 软件优化</h2><p>如果公司预算充足对于新的服务器是可以考虑购买更好的 CPU，但是对于已经在使用的服务器，硬件优化的方式可能就不太适合了，于是就要从软件的方向来优化了。</p><p>软件的优化方向可以分层两种，一个是<strong>软件升级</strong>，一个是<strong>协议优化</strong>。</p><p>先说第一个软件升级，软件升级就是将正在使用的软件升级到最新版本，因为最新版本不仅提供了最新的特性，也优化了以前软件的问题或性能。比如：</p><ul><li>将 Linux 内核从 2.x 升级到 4.x；</li><li>将 OpenSSL 从 1.0.1 升级到 1.1.1；</li><li>...</li></ul><p>看似简单的软件升级，对于有成百上千服务器的公司来说，软件升级也跟硬件升级同样是一个棘手的问题，因为要实行软件升级，会花费时间和人力，同时也存在一定的风险，也可能会影响正常的线上服务。</p><p>既然如此，我们把目光放到协议优化，也就是在现有的环节下，通过较小的改动，来进行优化。</p><hr><h2 id="协议优化" tabindex="-1"><a class="header-anchor" href="#协议优化" aria-hidden="true">#</a> 协议优化</h2><p>协议的优化就是对「密钥交换过程」进行优化。</p><h3 id="密钥交换算法优化" tabindex="-1"><a class="header-anchor" href="#密钥交换算法优化" aria-hidden="true">#</a> 密钥交换算法优化</h3><p>TLS 1.2 版本如果使用的是 RSA 密钥交换算法，那么需要 4 次握手，也就是要花费 2 RTT，才可以进行应用数据的传输，而且 RSA 密钥交换算法不具备前向安全性。</p><p>总之使用 <strong>RSA 密钥交换算法的 TLS 握手过程，不仅慢，而且安全性也不高</strong>。</p><p>因此如果可以，尽量<strong>选用 ECDHE 密钥交换</strong>算法替换 RSA 算法，因为该算法由于支持「False Start」，它是“抢跑”的意思，客户端可以在 TLS 协议的第 3 次握手后，第 4 次握手前，发送加密的应用数据，以此将 <strong>TLS 握手的消息往返由 2 RTT 减少到 1 RTT，而且安全性也高，具备前向安全性</strong>。</p><p>ECDHE 算法是基于椭圆曲线实现的，不同的椭圆曲线性能也不同，应该尽量<strong>选择 x25519 曲线</strong>，该曲线是目前最快的椭圆曲线。</p><p>比如在 Nginx 上，可以使用 ssl_ecdh_curve 指令配置想使用的椭圆曲线，把优先使用的放在前面：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/ssl_ecdh_curve.png" alt=""></p><p>对于对称加密算法方面，如果对安全性不是特别高的要求，可以<strong>选用 AES_128_GCM</strong>，它比 AES_256_GCM 快一些，因为密钥的长度短一些。</p><p>比如在 Nginx 上，可以使用 ssl_ciphers 指令配置想使用的非对称加密算法和对称加密算法，也就是密钥套件，而且把性能最快最安全的算法放在最前面：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/ssl_ciphers.png" alt=""></p><h3 id="tls-升级" tabindex="-1"><a class="header-anchor" href="#tls-升级" aria-hidden="true">#</a> TLS 升级</h3><p>当然，如果可以，直接把 TLS 1.2 升级成 TLS 1.3，TLS 1.3 大幅度简化了握手的步骤，<strong>完成 TLS 握手只要 1 RTT</strong>，而且安全性更高。</p><p>在 TLS 1.2 的握手中，一般是需要 4 次握手，先要通过 Client Hello （第 1 次握手）和 Server Hello（第 2 次握手） 消息协商出后续使用的加密算法，再互相交换公钥（第 3 和 第 4 次握手），然后计算出最终的会话密钥，下图的左边部分就是 TLS 1.2 的握手过程：</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/tls1.2and1.3.png" alt=""></p><p>上图的右边部分就是 TLS 1.3 的握手过程，可以发现 <strong>TLS 1.3 把 Hello 和公钥交换这两个消息合并成了一个消息，于是这样就减少到只需 1 RTT 就能完成 TLS 握手</strong>。</p><p>怎么合并的呢？具体的做法是，客户端在 Client Hello 消息里带上了支持的椭圆曲线，以及这些椭圆曲线对应的公钥。</p><p>服务端收到后，选定一个椭圆曲线等参数，然后返回消息时，带上服务端这边的公钥。经过这 1 个 RTT，双方手上已经有生成会话密钥的材料了，于是客户端计算出会话密钥，就可以进行应用数据的加密传输了。</p><p>而且，TLS1.3 对密码套件进行“减肥”了， <strong>对于密钥交换算法，废除了不支持前向安全性的 RSA 和 DH 算法，只支持 ECDHE 算法</strong>。</p><p>对于对称加密和签名算法，只支持目前最安全的几个密码套件，比如 openssl 中仅支持下面 5 种密码套件：</p><ul><li>TLS_AES_256_GCM_SHA384</li><li>TLS_CHACHA20_POLY1305_SHA256</li><li>TLS_AES_128_GCM_SHA256</li><li>TLS_AES_128_CCM_8_SHA256</li><li>TLS_AES_128_CCM_SHA256</li></ul><p>之所以 TLS1.3 仅支持这么少的密码套件，是因为 TLS1.2 由于支持各种古老且不安全的密码套件，中间人可以利用降级攻击，伪造客户端的 Client Hello 消息，替换客户端支持的密码套件为一些不安全的密码套件，使得服务器被迫使用这个密码套件进行 HTTPS 连接，从而破解密文。</p><hr><h2 id="证书优化" tabindex="-1"><a class="header-anchor" href="#证书优化" aria-hidden="true">#</a> 证书优化</h2><p>为了验证的服务器的身份，服务器会在 TLS 握手过程中，把自己的证书发给客户端，以此证明自己身份是可信的。</p><p>对于证书的优化，可以有两个方向：</p><ul><li>一个是<strong>证书传输</strong>，</li><li>一个是<strong>证书验证</strong>；</li></ul><h3 id="证书传输优化" tabindex="-1"><a class="header-anchor" href="#证书传输优化" aria-hidden="true">#</a> 证书传输优化</h3><p>要让证书更便于传输，那必然是减少证书的大小，这样可以节约带宽，也能减少客户端的运算量。所以，<strong>对于服务器的证书应该选择椭圆曲线（ECDSA）证书，而不是 RSA 证书，因为在相同安全强度下， ECC 密钥长度比 RSA 短的多</strong>。</p><h3 id="证书验证优化" tabindex="-1"><a class="header-anchor" href="#证书验证优化" aria-hidden="true">#</a> 证书验证优化</h3><p>客户端在验证证书时，是个复杂的过程，会走证书链逐级验证，验证的过程不仅需要「用 CA 公钥解密证书」以及「用签名算法验证证书的完整性」，而且为了知道证书是否被 CA 吊销，客户端有时还会再去访问 CA， 下载 CRL 或者 OCSP 数据，以此确认证书的有效性。</p><p>这个访问过程是 HTTP 访问，因此又会产生一系列网络通信的开销，如 DNS 查询、建立连接、收发数据等。</p><h4 id="crl" tabindex="-1"><a class="header-anchor" href="#crl" aria-hidden="true">#</a> CRL</h4><p>CRL 称为证书吊销列表（<em>Certificate Revocation List</em>），这个列表是由 CA 定期更新，列表内容都是被撤销信任的证书序号，如果服务器的证书在此列表，就认为证书已经失效，不在的话，则认为证书是有效的。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/crl.png" alt=""></p><p>但是 CRL 存在两个问题：</p><ul><li>第一个问题，由于 CRL 列表是由 CA 维护的，定期更新，如果一个证书刚被吊销后，客户端在更新 CRL 之前还是会信任这个证书，<strong>实时性较差</strong>；</li><li>第二个问题，<strong>随着吊销证书的增多，列表会越来越大，下载的速度就会越慢</strong>，下载完客户端还得遍历这么大的列表，那么就会导致客户端在校验证书这一环节的延时很大，进而拖慢了 HTTPS 连接。</li></ul><h4 id="ocsp" tabindex="-1"><a class="header-anchor" href="#ocsp" aria-hidden="true">#</a> OCSP</h4><p>因此，现在基本都是使用 OCSP ，名为在线证书状态协议（<em>Online Certificate Status Protocol</em>）来查询证书的有效性，它的工作方式是<strong>向 CA 发送查询请求，让 CA 返回证书的有效状态</strong>。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/ocsp.png" alt=""></p><p>不必像 CRL 方式客户端需要下载大大的列表，还要从列表查询，同时因为可以实时查询每一张证书的有效性，解决了 CRL 的实时性问题。</p><p>OCSP 需要向 CA 查询，因此也是要发生网络请求，而且还得看 CA 服务器的“脸色”，如果网络状态不好，或者 CA 服务器繁忙，也会导致客户端在校验证书这一环节的延时变大。</p><h4 id="ocsp-stapling" tabindex="-1"><a class="header-anchor" href="#ocsp-stapling" aria-hidden="true">#</a> OCSP Stapling</h4><p>于是为了解决这一个网络开销，就出现了 OCSP Stapling，其原理是：服务器向 CA 周期性地查询证书状态，获得一个带有时间戳和签名的响应结果并缓存它。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/opscp-stapling.png" alt=""></p><p>当有客户端发起连接请求时，服务器会把这个「响应结果」在 TLS 握手过程中发给客户端。由于有签名的存在，服务器无法篡改，因此客户端就能得知证书是否已被吊销了，这样客户端就不需要再去查询。</p><hr><h2 id="会话复用" tabindex="-1"><a class="header-anchor" href="#会话复用" aria-hidden="true">#</a> 会话复用</h2><p>TLS 握手的目的就是为了协商出会话密钥，也就是对称加密密钥，那我们如果我们把首次 TLS 握手协商的对称加密密钥缓存起来，待下次需要建立 HTTPS 连接时，直接「复用」这个密钥，不就减少 TLS 握手的性能损耗了吗？</p><p>这种方式就是<strong>会话复用</strong>（<em>TLS session resumption</em>），会话复用分两种：</p><ul><li>第一种叫 Session ID；</li><li>第二种叫 Session Ticket；</li></ul><h3 id="session-id" tabindex="-1"><a class="header-anchor" href="#session-id" aria-hidden="true">#</a> Session ID</h3><p>Session ID 的工作原理是，<strong>客户端和服务器首次 TLS 握手连接后，双方会在内存缓存会话密钥，并用唯一的 Session ID 来标识</strong>，Session ID 和会话密钥相当于 key-value 的关系。</p><p>当客户端再次连接时，hello 消息里会带上 Session ID，服务器收到后就会从内存找，如果找到就直接用该会话密钥恢复会话状态，跳过其余的过程，只用一个消息往返就可以建立安全通信。当然为了安全性，内存中的会话密钥会定期失效。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/sessionid.png" alt=""></p><p>但是它有两个缺点：</p><ul><li>服务器必须保持每一个客户端的会话密钥，随着客户端的增多，<strong>服务器的内存压力也会越大</strong>。</li><li>现在网站服务一般是由多台服务器通过负载均衡提供服务的，<strong>客户端再次连接不一定会命中上次访问过的服务器</strong>，于是还要走完整的 TLS 握手过程；</li></ul><h3 id="session-ticket" tabindex="-1"><a class="header-anchor" href="#session-ticket" aria-hidden="true">#</a> Session Ticket</h3><p>为了解决 Session ID 的问题，就出现了 Session Ticket，<strong>服务器不再缓存每个客户端的会话密钥，而是把缓存的工作交给了客户端</strong>，类似于 HTTP 的 Cookie。</p><p>客户端与服务器首次建立连接时，服务器会加密「会话密钥」作为 Ticket 发给客户端，交给客户端缓存该 Ticket。</p><p>客户端再次连接服务器时，客户端会发送 Ticket，服务器解密后就可以获取上一次的会话密钥，然后验证有效期，如果没问题，就可以恢复会话了，开始加密通信。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/ticket.png" alt=""></p><p>对于集群服务器的话，<strong>要确保每台服务器加密 「会话密钥」的密钥是一致的</strong>，这样客户端携带 Ticket 访问任意一台服务器时，都能恢复会话。</p><p>Session ID 和 Session Ticket <strong>都不具备前向安全性</strong>，因为一旦加密「会话密钥」的密钥被破解或者服务器泄漏「会话密钥」，前面劫持的通信密文都会被破解。</p><p>同时应对<strong>重放攻击</strong>也很困难，这里简单介绍下重放攻击工作的原理。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/重放攻击.png" alt=""></p><p>假设 Alice 想向 Bob 证明自己的身份。 Bob 要求 Alice 的密码作为身份证明，爱丽丝应尽全力提供（可能是在经过如哈希函数的转换之后）。与此同时，Eve 窃听了对话并保留了密码（或哈希）。</p><p>交换结束后，Eve（冒充 Alice ）连接到 Bob。当被要求提供身份证明时，Eve 发送从 Bob 接受的最后一个会话中读取的 Alice 的密码（或哈希），从而授予 Eve 访问权限。</p><p>重放攻击的危险之处在于，如果中间人截获了某个客户端的 Session ID 或 Session Ticket 以及 POST 报文，而一般 POST 请求会改变数据库的数据，中间人就可以利用此截获的报文，不断向服务器发送该报文，这样就会导致数据库的数据被中间人改变了，而客户是不知情的。</p><p>避免重放攻击的方式就是需要<strong>对会话密钥设定一个合理的过期时间</strong>。</p><h3 id="pre-shared-key" tabindex="-1"><a class="header-anchor" href="#pre-shared-key" aria-hidden="true">#</a> Pre-shared Key</h3><p>前面的 Session ID 和 Session Ticket 方式都需要在 1 RTT 才能恢复会话。</p><p>而 TLS1.3 更为牛逼，对于重连 TLS1.3 只需要 <strong>0 RTT</strong>，原理和 Ticket 类似，只不过在重连时，客户端会把 Ticket 和 HTTP 请求一同发送给服务端，这种方式叫 <strong>Pre-shared Key</strong>。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/0-RTT.png" alt=""></p><p>同样的，Pre-shared Key 也有重放攻击的危险。</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/网络/https优化/0-rtt-attack.png" alt=""></p><p>如上图，假设中间人通过某种方式，截获了客户端使用会话重用技术的 POST 请求，通常 POST 请求是会改变数据库的数据，然后中间人就可以把截获的这个报文发送给服务器，服务器收到后，也认为是合法的，于是就恢复会话，致使数据库的数据又被更改，但是此时用户是不知情的。</p><p>所以，应对重放攻击可以给会话密钥设定一个合理的过期时间，以及只针对安全的 HTTP 请求如 GET/HEAD 使用会话重用。</p><hr><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>对于硬件优化的方向，因为 HTTPS 是属于计算密集型，应该选择计算力更强的 CPU，而且最好选择<strong>支持 AES-NI 特性的 CPU</strong>，这个特性可以在硬件级别优化 AES 对称加密算法，加快应用数据的加解密。</p><p>对于软件优化的方向，如果可以，把软件升级成较新的版本，比如将 Linux 内核 2.X 升级成 4.X，将 openssl 1.0.1 升级到 1.1.1，因为新版本的软件不仅会提供新的特性，而且还会修复老版本的问题。</p><p>对于协议优化的方向：</p><ul><li>密钥交换算法应该选择 <strong>ECDHE 算法</strong>，而不用 RSA 算法，因为 ECDHE 算法具备前向安全性，而且客户端可以在第三次握手之后，就发送加密应用数据，节省了 1 RTT。</li><li>将 TLS1.2 升级 <strong>TLS1.3</strong>，因为 TLS1.3 的握手过程只需要 1 RTT，而且安全性更强。</li></ul><p>对于证书优化的方向：</p><ul><li>服务器应该选用 <strong>ECDSA 证书</strong>，而非 RSA 证书，因为在相同安全级别下，ECC 的密钥长度比 RSA 短很多，这样可以提高证书传输的效率；</li><li>服务器应该开启 <strong>OCSP Stapling</strong> 功能，由服务器预先获得 OCSP 的响应，并把响应结果缓存起来，这样 TLS 握手的时候就不用再访问 CA 服务器，减少了网络通信的开销，提高了证书验证的效率；</li></ul><p>对于重连 HTTPS 时，我们可以使用一些技术让客户端和服务端使用上一次 HTTPS 连接使用的会话密钥，直接恢复会话，而不用再重新走完整的 TLS 握手过程。</p><p>常见的<strong>会话重用</strong>技术有 Session ID 和 Session Ticket，用了会话重用技术，当再次重连 HTTPS 时，只需要 1 RTT 就可以恢复会话。对于 TLS1.3 使用 Pre-shared Key 会话重用技术，只需要 0 RTT 就可以恢复会话。</p><p>这些会话重用技术虽然好用，但是存在一定的安全风险，它们不仅不具备前向安全，而且有重放攻击的风险，所以应当对会话密钥设定一个合理的过期时间。</p><hr><p>参考资料：</p><ol><li>http://www.doc88.com/p-8621583210895.html</li><li>https://zhuanlan.zhihu.com/p/33685085</li><li>https://en.wikipedia.org/wiki/Replay_attack</li><li>https://en.wikipedia.org/wiki/Downgrade_attack</li><li>https://www.cnblogs.com/racent-Z/p/14011056.html</li><li>http://www.guoyanbin.com/a-detailed-look-at-rfc-8446-a-k-a-tls-1-3/</li><li>https://www.thesslstore.com/blog/crl-explained-what-is-a-certificate-revocation-list/</li></ol><hr></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1453300745@qq.com">wangtao</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.d6a6c857.js" defer></script>
  </body>
</html>
